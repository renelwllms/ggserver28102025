import{r as g,bk as xe,k as C,q as K,w as Oe,j as r,ae as Ne,ak as _e,H as X,R as W,aC as Ie,aD as Pe,u as pe,v as fe,al as oe,bl as Te,Z as ke,au as Ee,$ as Re,af as je,an as Fe,F as Le,K as $e,l as ie,ab as U,M as Y,Q,C as se,L as P,J as z,V as ce,O as De,U as de,ai as Be,ad as Ae}from"./index.bfa4e677.js";import{S as ze}from"./index.11c1af82.js";import{P as Me,R as Ve}from"./index.1ed8ca1f.js";import{h as We}from"./moment.0f22a298.js";import{E as qe}from"./exceljs.min.044c08df.js";import{F as Ke}from"./FileSaver.min.75cbdb4e.js";var H=globalThis&&globalThis.__assign||function(){return H=Object.assign||function(t){for(var n,l=1,a=arguments.length;l<a;l++){n=arguments[l];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},H.apply(this,arguments)},He=globalThis&&globalThis.__rest||function(t,n){var l={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&n.indexOf(a)<0&&(l[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(t);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(l[a[i]]=t[a[i]]);return l},Ge=globalThis&&globalThis.__read||function(t,n){var l=typeof Symbol=="function"&&t[Symbol.iterator];if(!l)return t;var a=l.call(t),i,y=[],h;try{for(;(n===void 0||n-- >0)&&!(i=a.next()).done;)y.push(i.value)}catch(c){h={error:c}}finally{try{i&&!i.done&&(l=a.return)&&l.call(a)}finally{if(h)throw h.error}}return y};function ee(t){var n,l,a=t.children,i=t.style,y=t.className,h=t.prefixCls,c=t.droplist,_=t.dropdownProps,k=t.href,E=t.onClick,w=t.tagName,x=w===void 0?"div":w,T=He(t,["children","style","className","prefixCls","droplist","dropdownProps","href","onClick","tagName"]),O=Ge(g.exports.useState(!1),2),N=O[0],L=O[1],$=xe(k)?"a":x,D=C($,{...H({href:k,onClick:E,role:"listitem",style:i,className:K(h+"-item",(n={},n[h+"-item-with-dropdown"]=c,n),y)},Oe(T)),children:[a,c&&r("span",{"aria-hidden":!0,className:K(h+"-item-dropdown-icon",(l={},l[h+"-item-dropdown-icon-active"]=N,l)),children:r(Ne,{})})]});return c?r(_e,{...H({droplist:c,onVisibleChange:function(R){L(R),_&&_.onVisibleChange&&_.onVisibleChange(R)}},X(_,["onVisibleChange"])),children:D}):D}ee.displayName="BreadcrumbItem";function ue(t,n){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),l.push.apply(l,a)}return l}function he(t){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?ue(Object(l),!0).forEach(function(a){Pe(t,a,l[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):ue(Object(l)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(l,a))})}return t}function Je(t,n){var l=g.exports.useContext(Ie),a=l.prefixCls,i=a===void 0?"arco":a,y=t.spin,h=t.className,c=he(he({"aria-hidden":!0,focusable:!1,ref:n},t),{},{className:"".concat(h?h+" ":"").concat(i,"-icon ").concat(i,"-icon-oblique-line")});return y&&(c.className="".concat(c.className," ").concat(i,"-icon-loading")),delete c.spin,delete c.isIcon,r("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...c,children:r("path",{d:"M29.506 6.502 18.493 41.498"})})}var te=W.forwardRef(Je);te.defaultProps={isIcon:!0};te.displayName="IconObliqueLine";var Ue=te,Z=globalThis&&globalThis.__assign||function(){return Z=Object.assign||function(t){for(var n,l=1,a=arguments.length;l<a;l++){n=arguments[l];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Z.apply(this,arguments)},Ye=globalThis&&globalThis.__rest||function(t,n){var l={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&n.indexOf(a)<0&&(l[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(t);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(l[a[i]]=t[a[i]]);return l},Qe=function(t,n,l){return n.indexOf(t)===n.length-1?r("span",{children:t.breadcrumbName}):r("a",{href:"#/"+l.join("/").replace(/^\//,""),children:t.breadcrumbName})},Ze={separator:r(Ue,{})};function Xe(t,n){var l,a=g.exports.useContext(pe),i=a.getPrefixCls,y=a.componentConfig,h=a.rtl,c=fe(t,Ze,y==null?void 0:y.Breadcrumb),_=c.className,k=c.children,E=c.style,w=c.routes,x=c.maxCount,T=c.separator,O=Ye(c,["className","children","style","routes","maxCount","separator"]),N=i("breadcrumb"),L="itemRender"in c?c.itemRender:Qe,$=r("span",{"aria-label":"ellipses of breadcrumb items",className:N+"-item-ellipses",children:"..."}),D=r("span",{"aria-hidden":!0,className:N+"-item-separator",children:T}),R=function(S,M,b){var j=W.cloneElement(D,{key:b+"_separator"});return M>0?b===0?[S,j,$]:b>M?[j,S]:null:b===0?[S]:[j,S]},B=function(){var S=[],M=w.length-x;return w.map(function(b,j){S.push((b.path||"").replace(/^\//,""));var G=b.children?r(oe,{children:b.children.map(function(V){return r(oe.Item,{children:L(V,w,S)},V.path||V.breadcrumbName)})}):null;return R(r(ee,{prefixCls:N,droplist:G,children:L(b,w,S)},b.path||b.breadcrumbName),M,j)})},f=function(){var S=[];W.Children.forEach(k,function(b){Te(b)||S.push(b)});var M=S.length-x;return W.Children.map(S,function(b,j){return R(W.cloneElement(b,{prefixCls:N}),M,j)})};return r("div",{...Z({role:"list",ref:n,style:E,className:K(N,(l={},l[N+"-rtl"]=h,l),_)},X(O,["itemRender"])),children:w&&w.length?B():f()})}var et=g.exports.forwardRef(Xe),re=et;re.displayName="Breadcrumb";re.Item=ee;var tt=re,q=globalThis&&globalThis.__assign||function(){return q=Object.assign||function(t){for(var n,l=1,a=arguments.length;l<a;l++){n=arguments[l];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},q.apply(this,arguments)},rt=globalThis&&globalThis.__rest||function(t,n){var l={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&n.indexOf(a)<0&&(l[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(t);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(l[a[i]]=t[a[i]]);return l},at=globalThis&&globalThis.__read||function(t,n){var l=typeof Symbol=="function"&&t[Symbol.iterator];if(!l)return t;var a=l.call(t),i,y=[],h;try{for(;(n===void 0||n-- >0)&&!(i=a.next()).done;)y.push(i.value)}catch(c){h={error:c}}finally{try{i&&!i.done&&(l=a.return)&&l.call(a)}finally{if(h)throw h.error}}return y};function me(t){var n,l,a=g.exports.useContext(pe),i=a.getPrefixCls,y=a.componentConfig,h=a.rtl,c=fe(t,{},y==null?void 0:y.PageHeader),_=c.title,k=c.subTitle,E=c.extra,w=c.children,x=c.backIcon,T=c.footer,O=c.breadcrumb,N=rt(c,["title","subTitle","extra","children","backIcon","footer","breadcrumb"]),L=ke(),$=at(g.exports.useState(!1),2),D=$[0],R=$[1],B=g.exports.useRef(),f=i("page-header");return r(Ee,{onResize:function(){B.current&&R(B.current.offsetWidth<768)},getTargetDOMNode:function(){return B.current},children:C("div",{...q({},X(N,["onBack"]),{ref:B,className:K(""+f,(n={},n[f+"-with-breadcrumb"]=O,n[f+"-with-content"]=w,n[f+"-with-footer"]=T,n[f+"-wrap"]=D,n[f+"-rtl"]=h,n),c.className),style:c.style}),children:[C("div",{className:f+"-head-wrapper",children:[O&&r(tt,{...q({},O)}),C("div",{className:f+"-head",children:[C("div",{className:K(f+"-head-main",(l={},l[f+"-head-main-with-back"]=x,l)),children:[x&&r(Re,{...q({prefix:f,tabIndex:0,role:"button",className:f+"-back",onClick:c.onBack},L({onPressEnter:c.onBack})),children:r("span",{className:f+"-back-icon",children:x===!0?h?r(je,{}):r(Fe,{}):x})}),_&&r("div",{className:f+"-title",children:_}),k&&C(Le,{children:[r("div",{className:f+"-divider"}),r("div",{className:f+"-sub-title",children:k})]})]}),E&&r("div",{className:f+"-head-extra",children:E})]})]}),w&&r("div",{className:f+"-content",children:w}),T&&r("div",{className:f+"-footer",children:T})]})})}me.displayName="PageHeader";const v=z.Option,{useForm:nt}=P;function ut(){const[t]=nt(),[n,l]=g.exports.useState([]),[a,i]=g.exports.useState(1),[y,h]=g.exports.useState(!1),[c,_]=g.exports.useState([]);g.exports.useState([]);const[k,E]=g.exports.useState([]),[w,x]=g.exports.useState(0),T=$e(e=>e.token);g.exports.useState({});const[O,N]=g.exports.useState({total:0,pageSize:10,current:1}),[L,$]=g.exports.useState([]),[D,R]=g.exports.useState([]),[B,f]=g.exports.useState([]),[S,M]=g.exports.useState(["NZ European","Maori","Cook Island Maori","Niuean","Samoan","Tongan","Fijian","Tokelauan","Chinese","Indian","Japanese","Korean","Vietnamese","Filipino","Malaysian","Indonesian","Thai","Middle Eastern/Latin American/African","Other"]);g.exports.useEffect(()=>{T&&(J(),j(),G(),V())},[T]);const b=e=>{l(e)},j=async()=>{try{const e=await ie.getSchool();if(e.code===0){const o=(e.data||[]).sort((s,d)=>{var I,u;const p=((I=s.SchoolName)==null?void 0:I.toLowerCase())||"",m=((u=d.SchoolName)==null?void 0:u.toLowerCase())||"";return p.localeCompare(m)});$(o)}}catch(e){console.error("Error loading schools:",e)}},G=async()=>{try{const e=await ie.getAllTutorList();if(e.code===0){const o=(e.data||[]).sort((s,d)=>{var I,u;const p=((I=s.TutorName)==null?void 0:I.toLowerCase())||"",m=((u=d.TutorName)==null?void 0:u.toLowerCase())||"";return p.localeCompare(m)});R(o)}}catch(e){console.error("Error loading tutors:",e)}},V=async()=>{try{const e=await U.getReport({pageSize:1e4,isReport:1});if(e.code===0&&e.data&&e.data[1]){const o=[...new Set(e.data[1].map(s=>s.Region).filter(s=>s&&s.trim()!==""))].sort();f(o)}}catch(e){console.error("Error loading regions:",e)}},ae=[{title:"Learner Name",key:"StudentName",dataIndex:"StudentName",width:160,render:(e,o)=>`${o.FirstName||""} ${o.LastName||""}`},{title:"DOB",dataIndex:"DateOfBirth",key:"DateOfBirth",width:120,ellipsis:!0,render:e=>e?We(e).format("DD/MM/YYYY"):"-"},{title:"Gender",dataIndex:"Gender",key:"Gender",width:85},{title:"Ethnicity",dataIndex:"Ethnicity",key:"Ethnicity",ellipsis:!0,width:100},{title:"Email",dataIndex:"Email",key:"Email",ellipsis:!0,width:120},{title:"School",dataIndex:"School",key:"School",ellipsis:!0,width:160},{title:"Teacher",dataIndex:"Tutor",key:"Tutor",ellipsis:!0,width:160},{title:"Fees",dataIndex:"Fees",key:"Fees",width:90,ellipsis:!0,render:e=>r("span",{style:{fontSize:"12px"},children:e})},{title:"Region",dataIndex:"Region",key:"Region",ellipsis:!0,width:160},{title:"Status",dataIndex:"Status",key:"Status",ellipsis:!0,width:160}],ge=e=>{const{current:o,pageSize:s}=e;N({...e,current:o,pageSize:s}),J({current:o,pageSize:s})},J=(e={})=>{h(!0),U.getReport({...O,...e,total:void 0}).then(o=>{var s,d,p,m;console.log((s=o==null?void 0:o.data)==null?void 0:s[0]),E(((d=o==null?void 0:o.data)==null?void 0:d[0])||[]),_(((p=o==null?void 0:o.data)==null?void 0:p[1])||[]),N({...O,...o==null?void 0:o.pagination}),be((m=o==null?void 0:o.data)==null?void 0:m[0])}).catch(o=>{console.error("Error loading learner results:",o),Y.error("Failed to load report data. Please try again."),E([]),_([])}).finally(()=>{h(!1)})},ye=(e={})=>{h(!0),U.getReport({...O,...e,total:void 0}).then(o=>{var s,d;console.log((s=o==null?void 0:o.data)==null?void 0:s[0]),we(ae,((d=o==null?void 0:o.data)==null?void 0:d[1])||[],"LearnerResults"),Y.success("Excel file exported successfully!")}).catch(o=>{console.error("Error exporting report:",o),Y.error("Failed to export report. Please try again.")}).finally(()=>{h(!1)})};function be(e){var I;if(!e||e.length===0){x(0);return}try{var o=e.reduce((u,F)=>u+(F.TotalCourse||0),0),s=e.filter(u=>u.CourseStatus!=="On Going").reduce((u,F)=>u+(F.TotalCourse||0),0),d=((I=e.find(u=>u.CourseStatus==="Not Yet Achieved"))==null?void 0:I.TotalCourse)||0,p=e.filter(u=>["Achieved","Excellence","Merit"].includes(u.CourseStatus)).reduce((u,F)=>u+(F.TotalCourse||0),0),m=d>0?(p/(p+d)*100).toFixed(1):0;x(m)}catch(u){console.error("Error calculating statistics:",u),x(0)}}function ne(e){return Object.fromEntries(Object.entries(e).filter(([o,s])=>s!=null&&s!==""))}function le(e){const o=Object.entries(e).filter(([s,d])=>d!=null&&d!=="").map(([s,d])=>{const p=s.replace(/_/g,".");if(Array.isArray(d)){const m=d.filter(u=>u!=null&&u!=="");if(m.length===0)return null;if(m.length===2&&typeof m[0]=="string"&&typeof m[1]=="string"&&m[0].includes("-"))return`${p} >= '${m[0]}' AND ${p} <= '${m[1]}'`;if(m.length===1)return`${p} = '${m[0]}'`;{const u=m.map(F=>`'${String(F).replace(/'/g,"''")}'`).join(", ");return`${p} IN (${u})`}}else return typeof d=="string"?`${p} = '${d.replace(/'/g,"''")}'`:typeof d=="number"?`${p} = ${d}`:d===null?`${p} IS NULL`:typeof d=="boolean"?`${p} = ${d?1:0}`:`${p} = '${String(d).replace(/'/g,"''")}'`}).filter(s=>s!==null);return o.length>0?o.join(" AND "):""}const ve=()=>{const e=t.getFieldsValue();console.log(e);var o=ne(e);console.log(o);var s=le(o);console.log(s),J({current:1,dyquery:s})},we=async(e,o,s)=>{const d=new qe.Workbook,p=d.addWorksheet("Sheet1");p.mergeCells("A1:C1");const m=p.getCell("A1");m.value=s,m.font={size:20,bold:!0},m.alignment={horizontal:"center",vertical:"middle"};const I=p.addRow(e.map(A=>A.title));I.eachCell(A=>{A.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ED45A0"}},A.font={color:{argb:"FFFFFFFF"},bold:!0}}),I.height=25,o.forEach(A=>{p.addRow(e.map(Se=>A[Se.dataIndex]))}),p.columns.forEach(A=>{A.width=30});const u=await d.xlsx.writeBuffer(),F=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ke.exports.saveAs(F,`${s}.xlsx`)},Ce=()=>{const e=t.getFieldsValue();console.log(e);var o=ne(e);console.log(o);var s=le(o);console.log(s),ye({current:1,isReport:1,dyquery:s})};return C("div",{style:{padding:20},children:[r(me,{title:"Learner Results"}),r(Q,{style:{marginBottom:0,width:"100%"},children:r(se,{style:{marginBottom:20},children:C(P,{form:t,layout:"inline",children:[r(P.Item,{label:"Filter",children:C(z,{placeholder:"Select",style:{width:200},mode:"multiple",value:n,onChange:b,allowClear:!0,children:[r(v,{value:"date",children:"Date"}),r(v,{value:"enrollmentType",children:"Enrollment Type"}),r(v,{value:"ethnicity",children:"Ethnicity"}),r(v,{value:"firstName",children:"First Name"}),r(v,{value:"fees",children:"Fees"}),r(v,{value:"lastName",children:"Last Name"}),r(v,{value:"region",children:"Region"}),r(v,{value:"school",children:"School"}),r(v,{value:"tutor",children:"Tutor"})]})}),n.includes("firstName")&&r(P.Item,{label:"First Name",field:"S_FirstName",children:r(ce,{allowClear:!0,style:{width:"100%"},placeholder:"please enter"})}),n.includes("lastName")&&r(P.Item,{label:"Last Name",field:"S_LastName",children:r(ce,{allowClear:!0,style:{width:"100%"},placeholder:"please enter"})}),n.includes("enrollmentType")&&r(P.Item,{label:"Enrollment Type",field:"SIC_LearnerType",children:C(z,{defaultValue:"all",style:{width:160},children:[r(v,{value:"1",children:"Remote"}),r(v,{value:"2",children:"Workshop"})]})}),n.includes("fees")&&r(P.Item,{label:"Fees",field:"S_Fees",children:C(z,{style:{width:160},children:[r(v,{value:"Paid",children:"Paid"}),r(v,{value:"Parially Paid",children:"Parially Paid"}),r(v,{value:"Un Paid",children:"Un Paid"})]})}),n.includes("date")&&r(P.Item,{label:"Date",field:"S_CreateDate",children:r(De.RangePicker,{})}),n.includes("school")&&r(P.Item,{label:"School",field:"S_School",children:r(z,{mode:"multiple",placeholder:"Select schools",style:{width:300},showSearch:!0,allowClear:!0,filterOption:(e,o)=>{var s;return(s=o.props.children)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},children:L.map(e=>r(v,{value:e.SchoolName,children:e.SchoolName},e.SchoolNumber))})}),n.includes("ethnicity")&&r(P.Item,{label:"Ethnicity",field:"S_Ethnicity",children:r(z,{mode:"multiple",placeholder:"Select ethnicity",style:{width:300},showSearch:!0,allowClear:!0,filterOption:(e,o)=>{var s;return(s=o.props.children)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},children:S.map(e=>r(v,{value:e,children:e},e))})}),n.includes("region")&&r(P.Item,{label:"Region",field:"S_Region",children:r(z,{mode:"multiple",placeholder:"Select regions",style:{width:300},showSearch:!0,allowClear:!0,filterOption:(e,o)=>{var s;return(s=o.props.children)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},children:B.map(e=>r(v,{value:e,children:e},e))})}),n.includes("tutor")&&r(P.Item,{label:"Tutor",field:"S_Tutor",children:r(z,{mode:"multiple",placeholder:"Select tutors",style:{width:300},showSearch:!0,allowClear:!0,filterOption:(e,o)=>{var s;return(s=o.props.children)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},children:D.map(e=>r(v,{value:e.TutorName,children:e.TutorName},e.TutorID))})}),C(Q,{children:[r(de,{type:"primary",icon:r(Be,{}),onClick:ve,children:"Search"}),r(de,{onClick:()=>Ce(),type:"primary",style:{marginLeft:20},children:"Export Excel"})]})]})})}),r(se,{style:{marginBottom:20},children:C(Q,{align:"center",style:{width:"100%",justifyContent:"space-between"},children:[C("div",{style:{display:"flex",alignItems:"center",gap:20},children:[r(Me,{type:"circle",percent:w,width:80}),C(Ae.Text,{children:["Passed ",w,"%"]})]}),k.map((e,o)=>r(ze,{title:e.CourseStatus,value:e.TotalCourse},e.CourseStatus))]})}),r(Ve,{columns:ae,rowKey:"ID",data:c,loading:y,scroll:{x:1e3},border:{wrapper:!0,cell:!0},pagination:{...O,size:"mini",bufferSize:3,sizeCanChange:!0,showTotal:!0,showJumper:!0,pageSizeChangeResetCurrent:!0},onChange:ge},a)]})}export{ut as default};
