import{J as C,K as ee,r as s,l as F,N as x,j as t,k as f,L as i,O as te,P as oe,Q as re,U as k,G as E,C as ae,V as le,W as se,X as ne,Y as ce,M as I}from"./index.bfa4e677.js";import{C as G}from"./index.ba469e81.js";import{s as Q,g as R}from"./addressHelper.877a29ba.js";import{c as ie,t as de}from"./teacher.b2f809ec.js";const{Row:he,Col:we}=E,{useForm:pe}=i,me=C.Option;function ue(d){const[h]=pe(),p=ee(e=>e.token),[g,S]=s.exports.useState(!1),[y,N]=s.exports.useState([]),[P,w]=s.exports.useState(!1),[a,c]=s.exports.useState([]),[m,W]=s.exports.useState([]),[D,O]=s.exports.useState(),[$,Y]=s.exports.useState([]),[M,K]=s.exports.useState([]),z=d.IsPaidAllow;s.exports.useEffect(()=>{p&&(J(),H(),X())},[p]);const J=async(e={})=>{try{const[o,r]=await Promise.all([F.getCourse({}),F.getSchool({})]);N((o==null?void 0:o.data)||[]),c(o==null?void 0:o.data.filter(l=>l.IsCustom==!0).map(l=>l.CourseID)),W((r==null?void 0:r.data)||[])}catch(o){console.error("Failed to load options:",o),x.error({title:"Error",content:"Failed to load course and school options. Please refresh the page.",duration:5e3})}},X=async(e={})=>{try{const o=await ie.getUnits(e);K((o==null?void 0:o.data)||[])}catch(o){console.error("Failed to load unit standards:",o),x.error({title:"Error",content:"Failed to load unit standards.",duration:3e3})}},H=async(e={})=>{try{const o=await de.getAll(e);Y((o==null?void 0:o.data)||[])}catch(o){console.error("Failed to load teachers:",o),x.error({title:"Error",content:"Failed to load teacher list.",duration:3e3})}},Z=async e=>{var o,r,l,n,T,U;S(!0);try{let b=(o=e==null?void 0:e.SchoolName)==null?void 0:o.value,q=(r=e==null?void 0:e.SchoolName)==null?void 0:r.label;typeof((l=e==null?void 0:e.SchoolName)==null?void 0:l.value)!="number"&&(b=0,q=(n=e==null?void 0:e.SchoolName)==null?void 0:n.value);const V=R(D),v={...e,CourseID:(T=e==null?void 0:e.CourseID)==null?void 0:T.value,CourseName:(U=e==null?void 0:e.CourseID)==null?void 0:U.label,SchoolNumber:b,SchoolName:q,Location:V,TutorId:e==null?void 0:e.TutorId},u=await F.addWorkshop(v);if(u!=null&&u.data){const A=typeof u.data=="object"?u.data:{code:u.data,qrCode:null};x.success({title:"Success",content:`Workshop created successfully! Code: ${A.code}`,duration:4e3}),d.onSubmit(A),L()}}catch(b){console.error("Failed to create workshop:",b),x.error({title:"Error",content:"Failed to create workshop. Please try again.",duration:5e3})}finally{S(!1)}},L=()=>{h.resetFields(),O(void 0),w(!1)},_=e=>{a.includes(e.value)?w(!0):w(!1)};return t("div",{className:Q["search-form-wrapper"],children:f(i,{form:h,className:Q["search-form"],labelAlign:"left",wrapperCol:{span:24},onSubmit:Z,children:[t(i.Item,{label:"Workshop Name",field:"CourseID",rules:[{required:!0,message:"Please select a workshop name"}],children:t(C,{allowCreate:!0,labelInValue:!0,showSearch:!0,allowClear:!0,options:y.map(e=>({label:e.CourseName,value:e.CourseID})),filterOption:(e,o)=>{var r,l,n;return((l=(r=o.props.value)==null?void 0:r.label)==null?void 0:l.toLowerCase().indexOf(e.toLowerCase()))>=0||((n=o.props)==null?void 0:n.children.toLowerCase().indexOf(e.toLowerCase()))>=0},placeholder:"please enter",onChange:_})}),P&&t(i.Item,{label:"Unit Standards",field:"UnitStandardIDs",children:t(C,{mode:"multiple",placeholder:"Select unit standards",allowClear:!0,showSearch:!0,filterOption:(e,o)=>{var r,l,n;return((n=(l=(r=o.props)==null?void 0:r.children)==null?void 0:l.toLowerCase())==null?void 0:n.indexOf(e==null?void 0:e.toLowerCase()))>=0},children:M.map(e=>t(me,{value:e.UnitStandardID,children:`${e.US} - ${e.USName}`},e.UnitStandardID))})}),t(i.Item,{label:"Course Date",field:"CourseDate",rules:[{required:!0,message:"Please select a course date"}],children:t(te,{format:e=>`${e.format("DD/MM/YYYY")}`,style:{width:"100%"}})}),t(he,{children:t(i.Item,{label:"School Name",field:"SchoolName",rules:[{required:!0,message:"Please select or enter a school name"}],children:t(C,{labelInValue:!0,showSearch:!0,allowClear:!0,options:m.map(e=>({label:e.SchoolName,value:e.SchoolNumber})),allowCreate:{formatter:e=>({value:e,label:e})},filterOption:(e,o)=>{var r,l,n;return((l=(r=o.props.value)==null?void 0:r.label)==null?void 0:l.toLowerCase().indexOf(e.toLowerCase()))>=0||((n=o.props)==null?void 0:n.children.toLowerCase().indexOf(e.toLowerCase()))>=0},placeholder:"please select (If the option does not exist, you can enter it manually)",onChange:e=>{var o=m.filter(r=>r.SchoolNumber==e.value);o.length>0?O(o[0]):O(null)}})})}),D&&t("p",{children:R(D)}),t(i.Item,{label:"Number of learners attending",field:"StudentsNum",rules:[{required:!0,message:"Please enter the number of learners attending"}],children:t(oe,{placeholder:"Please enter",min:0,style:{width:"100%"}})}),t(i.Item,{label:"Teacher",field:"TutorId",rules:[{required:!0,message:"Please select a teacher"}],children:t(C,{allowClear:!0,options:$.map(e=>({label:e.DeliverySpecialist,value:e.Id})),placeholder:"Select teacher"})}),z&&t(i.Item,{label:"Payment Status",field:"PaymentStatus",children:t(C,{allowClear:!0,options:["Paid","Partially Paid","Unpaid"],placeholder:"Select payment status"})}),t(i.Item,{style:{textAlign:"center"},children:f(re,{children:[t(k,{loading:g,type:"primary",htmlType:"submit",children:"Submit"}),t(k,{onClick:L,children:"Reset"})]})})]})})}const Ce=G.Item,{Row:B,Col:j}=E;function xe(){const[d,h]=s.exports.useState(""),[p,g]=s.exports.useState(""),[S,y]=s.exports.useState(null);s.exports.useEffect(()=>{try{const a=localStorage.getItem("generateCode"),c=localStorage.getItem("generateQRCode");a&&g(a),c&&y(c)}catch(a){console.error("Failed to load from localStorage:",a)}},[]);function N(){if(!d)return I.warning("Please enter a workshop code");window.open(`/learner?code=${d}`)}const P=()=>{try{localStorage.setItem("generateCode",""),localStorage.setItem("generateQRCode",""),g(""),y(null)}catch(a){console.error("Failed to clear localStorage:",a),I.error("Failed to clear code")}},w=a=>{try{const c=typeof a=="string"?a:a.code,m=typeof a=="object"?a.qrCode:null;localStorage.setItem("generateCode",c),g(c),h(c),m&&(localStorage.setItem("generateQRCode",m),y(m))}catch(c){console.error("Failed to save to localStorage:",c),I.error("Failed to save code")}};return f(ae,{children:[t("div",{style:{marginBottom:"20px"},children:t(B,{gutter:[12,12],justify:"center",children:t(j,{xs:24,sm:20,md:16,lg:14,xl:12,children:t(le.Search,{value:d,placeholder:"Enter the workshop code to start collecting learners data",onChange:a=>h(a),searchButton:t(se,{content:"Open learner collection page",children:t(k,{type:"primary",icon:t(ne,{})})}),onSearch:N})})})}),t(B,{justify:"center",children:t(j,{xs:24,sm:20,md:18,lg:16,xl:14,children:t(G,{defaultActiveKey:["1"],children:t(Ce,{header:"Generate a unique workshop group code",name:"1",children:p?f("div",{style:{marginBottom:"20px"},children:[f("div",{style:{marginBottom:"20px"},children:[t("div",{style:{marginBottom:"10px"},children:"The currently generated code:"}),t(ce,{color:"#00b42a",style:{margin:"0 16px 16px 0",cursor:"pointer"},onClick:()=>{h(p),I.success("Code copied to input field")},children:p})]}),S&&f("div",{style:{marginBottom:"20px",textAlign:"center"},children:[t("div",{style:{marginBottom:"10px",fontWeight:"bold"},children:"QR Code for Students"}),t("div",{style:{display:"inline-block",padding:"20px",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:t("img",{src:S,alt:"Workshop QR Code",style:{width:"300px",height:"300px",display:"block"}})}),t("div",{style:{marginTop:"10px",color:"#86909c",fontSize:"14px"},children:"Students can scan this QR code to enroll in the workshop"})]}),t(k,{onClick:P,type:"primary",children:"Generate again"})]}):t(ue,{onSubmit:w,IsPaidAllow:!1})})})})})]})}export{xe as default};
