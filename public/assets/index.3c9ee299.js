import{K as ae,r as o,ah as ot,l as $,j as e,L as p,k as f,J as R,V as at,Q as te,U as m,ai as nt,G as lt,a8 as ee,S as Pe,ag as ne,M as A,bd as rt,F as it,O as dt,P as ct,C as qe,a6 as Ae,ad as ut,aa as xe,N as Se}from"./index.457aa18e.js";import{T as Ee}from"./index.f5cc6157.js";import{I as ht,P as ve}from"./communication.16bca290.js";import{h as Ke}from"./moment.0f22a298.js";import{b as Oe,c as pt,S as mt,U as ft,A as St}from"./updateForm.3e79e3a0.js";import{c as Te,t as yt}from"./teacher.182fbac0.js";import{R as we}from"./index.f41f3485.js";import{s as He,g as gt}from"./addressHelper.877a29ba.js";const{Row:Ct,Col:ke}=lt,{useForm:bt}=p;function xt(C){const[N]=bt(),F=ae(a=>a.token),[y,b]=o.exports.useState([]),[E,x]=o.exports.useState([]),[k,w]=o.exports.useState({SchoolNumber:0}),[T,D]=o.exports.useState(!1),U=o.exports.useRef(ot(a=>{C.onSearch({...a,schoolOptionVal:k==null?void 0:k.SchoolNumber}),D(!1)},500)).current;o.exports.useEffect(()=>()=>{U.cancel()},[U]),o.exports.useEffect(()=>{F&&W()},[F]);const W=()=>{$.getCourse({}).then(a=>{b((a==null?void 0:a.data)||[])}),$.getSchool({}).then(a=>{x((a==null?void 0:a.data)||[])})},L=a=>{C.onSearch({...a,schoolOptionVal:k==null?void 0:k.SchoolNumber})},j=()=>{D(!0);const a=N.getFieldsValue();U({...a,schoolOptionVal:k==null?void 0:k.SchoolNumber})},z=()=>{U.cancel(),D(!1),N.resetFields(),C.onSearch({})},X=a=>{a.key==="Enter"&&(U.cancel(),D(!1),N.submit())};return e("div",{children:e(p,{form:N,className:Oe["search-form"],labelAlign:"left",layout:"vertical",autoComplete:"off",style:{marginBottom:"16px"},onSubmit:L,children:f(Ct,{gutter:[12,12],children:[e(ke,{xs:24,sm:12,md:8,lg:6,xl:5,children:e(p.Item,{label:"Workshop Name",field:"CourseID",style:{marginBottom:0},children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,filterOption:(a,u)=>{var S,g,O;return((g=(S=u.props.value)==null?void 0:S.label)==null?void 0:g.toLowerCase().indexOf(a.toLowerCase()))>=0||((O=u.props)==null?void 0:O.children.toLowerCase().indexOf(a.toLowerCase()))>=0},options:y.map(a=>({label:a.CourseName,value:a.CourseID})),placeholder:"Select workshop"})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:4,children:e(p.Item,{label:"Workshop Code",field:"Code",style:{marginBottom:0},children:e(at,{onKeyDown:X,onChange:j,allowClear:!0,placeholder:"Enter code"})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:5,children:e(p.Item,{label:"School Name",field:"SchoolName",style:{marginBottom:0},children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:E.map(a=>({label:a.SchoolName,value:a.SchoolNumber})),allowCreate:{formatter:a=>({value:a,label:a})},filterOption:(a,u)=>{var S,g,O;return((g=(S=u.props.value)==null?void 0:S.label)==null?void 0:g.toLowerCase().indexOf(a.toLowerCase()))>=0||((O=u.props)==null?void 0:O.children.toLowerCase().indexOf(a.toLowerCase()))>=0},placeholder:"Select school",onChange:a=>{if(!a){w(null);return}const u=E.filter(S=>S.SchoolNumber==a.value);u.length>0?w(u[0]):w(null)}})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:4,style:{display:"flex",alignItems:"flex-end"},children:f(te,{wrap:!0,style:{marginBottom:0},children:[e(m,{type:"primary",icon:e(nt,{}),onClick:()=>{N.submit()},children:"Search"}),e(m,{icon:e(ht,{}),onClick:z,children:"Reset"})]})})]})})})}const kt=p.Item;R.Option;function wt({id:C,unitVisible:N,setUnitVisible:F,studentData:y,assesCourseData:b,refreshData:E,studentUnitStaderd:x}){const[k,w]=o.exports.useState(!1),T=ae(a=>a.token),[D]=ee(),[U,W]=o.exports.useState(!1);o.exports.useState({});const[L,j]=o.exports.useState([]);o.exports.useEffect(()=>{console.log("inti Assess"),T&&(console.log("inti Assess b"),z(b)),b&&console.log("inti Assess c : ",C)},[T,y,b,x]);const z=(a={})=>{Te.getUnits(a).then(u=>{if(j((u==null?void 0:u.data)||[]),console.log("Alll aditional unitstd",x),x){var S=x.filter(g=>g.IsAditional==!0).map(g=>g.UnitStandardID);D.setFieldValue("UnitStandardIDs",S)}})};return e(Pe,{loading:k,block:!0,children:e(ne,{title:"Unit Standard",visible:N,footer:null,onCancel:()=>{F(!1)},autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px",height:"50%"},children:f(p,{form:D,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:a=>{var S;W(!0);var u=[];(S=a==null?void 0:a.UnitStandardIDs)==null||S.forEach(g=>{console.log(g);var O=L.filter(J=>J.UnitStandardID==g);O.length>0&&u.push({...O[0],UnitStandard:O[0].US,IsAditional:!0})}),E(u),F(!1),W(!1)},children:[e(kt,{label:"Unit Standards",field:"UnitStandardIDs",children:e(R,{mode:"multiple",placeholder:"Select unit standards",allowClear:!0,showSearch:!0,options:L==null?void 0:L.map(a=>({label:`${a.US} - ${a.USName}`,value:a.UnitStandardID})),filterOption:(a,u)=>{var S,g,O;return((g=(S=u.props.value)==null?void 0:S.label)==null?void 0:g.toLowerCase().indexOf(a.toLowerCase()))>=0||((O=u.props)==null?void 0:O.children.toLowerCase().indexOf(a.toLowerCase()))>=0}})}),e(p.Item,{style:{textAlign:"center",marginTop:"50%"},children:f(te,{children:[e(m,{loading:U,type:"primary",htmlType:"submit",children:"Submit"}),e(m,{onClick:()=>{F(!1)},children:"Cancel"})]})})]})})})}function It({Code:C,statusVisible:N,setStatusVisible:F,WorkshopStatus:y,list:b}){const[E,x]=o.exports.useState(!1),k=ae(L=>L.token),[w]=ee(),[T,D]=o.exports.useState(!1);o.exports.useEffect(()=>{console.log("inti Assess"),w.resetFields(),k&&console.log("inti Assess b"),y&&w.setFieldValue("Status",y)},[k,y]);const U=()=>{F(!1)};return e(Pe,{loading:E,block:!0,children:e(ne,{title:"Change Workshop Status",visible:N,footer:null,onCancel:U,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px"},children:f(p,{form:w,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:L=>{D(!0);var j={...L,code:C};console.log(j),$.WorkshopStatusChange(j).then(z=>{z!=null&&z.data&&(F(!1),A.success("success"),b())}).finally(()=>{D(!1)})},children:[e(p.Item,{label:"Workshop Status",field:"Status",children:e(R,{allowClear:!0,options:["Unprocessed","Processed"],placeholder:"please enter"})}),e(p.Item,{style:{textAlign:"center"},children:f(te,{children:[e(m,{loading:T,type:"primary",htmlType:"submit",children:"Submit"}),e(m,{onClick:U,children:"Cancel"})]})})]})})})}p.Item;Ee.TabPane;R.Option;const Ge=["Achieved","Partially Completed","Merit","Excellence","Not Yet Achieved"];function Nt({Code:C,status:N,getWorkshopList:F,workShopData:y}){var Ye;const[b,E]=o.exports.useState(!1),[x,k]=o.exports.useState([]),[w,T]=o.exports.useState({}),[D,U]=o.exports.useState({}),[W]=ee(),[L]=ee(),[j]=ee();ee();const[z]=ee(),[X,a]=o.exports.useState(!1),[u,S]=o.exports.useState(!1),[g,O]=o.exports.useState(!1),[J,K]=o.exports.useState(!1),[l,i]=o.exports.useState(!1),[P,I]=o.exports.useState(!1),[Y,_]=o.exports.useState(!1),[ye,ge]=o.exports.useState(!1);o.exports.useState(!1);const[G,se]=o.exports.useState({}),[Ie,le]=o.exports.useState(!1),[Ne,ce]=o.exports.useState(!1),[ue,t]=o.exports.useState(!1);o.exports.useState([]);const[n,c]=o.exports.useState([]),[q,oe]=o.exports.useState([]),[re,We]=o.exports.useState([]),he=0,pe=[{title:"Learner Name",key:"StudentName",dataIndex:"StudentName",width:150,render:(s,d)=>`${d.FirstName||""} ${d.LastName||""}`},{title:"DOB",dataIndex:"DateOfBirth",key:"DateOfBirth",width:100,ellipsis:!0,render:s=>Ke(s).format("DD/MM/YYYY")},{title:"Gender",dataIndex:"Gender",key:"Gender",width:80},{title:"Ethnicity",dataIndex:"Ethnicity",key:"Ethnicity",ellipsis:!0,width:100},{title:"Email",dataIndex:"Email",key:"Email",ellipsis:!0,width:150},{title:"School Name",dataIndex:"SchoolName",key:"SchoolName",ellipsis:!0,width:150},{title:"Course Status",dataIndex:"CourseStatus",key:"CourseStatus",width:105,render:s=>e("span",{style:{fontSize:"12px"},children:s})},{title:"Operation",dataIndex:"operation",key:"operation",render:(s,d)=>f(te,{children:[e(m,{type:"primary",size:"mini",onClick:h=>{h.stopPropagation(),ie(d),se(d),i(!0)},children:"Assess"}),e(m,{type:"primary",size:"mini",onClick:h=>{if(h.stopPropagation(),console.log(d),!d.CourseStatus)return A.warning("Not yet assessed");if(!d.CourseStatus||d.CourseStatus==="Not Yet Achieved")return A.warning("Not yet achieved");ce(!1),se(d),le(!0)},children:"Certificate"}),e(m,{type:"primary",size:"mini",onClick:h=>{h.stopPropagation(),se(d),z.setFieldsValue({...d,SchoolName:d.SchoolNumber?d.SchoolNumber:d.SchoolName}),t(!0)},children:"Edit"}),e("div",{onClick:h=>{h.stopPropagation()},children:e(ve,{focusLock:!0,title:"Confirm",content:"Are you sure you want to delete?",onOk:()=>{Xe(d.StudentID)},children:e(m,{type:"primary",status:"danger",size:"mini",children:"Delete"})})})]}),width:220}];o.exports.useEffect(()=>{de(),Je();var s={label:y.SchoolName,value:y.SchoolNumber};W.setFieldValue("SchoolName",s)},[C]),o.exports.useEffect(()=>{},[n]);const ie=s=>{var d=[];if(s!=null&&s.Result){var h=JSON.parse(s.Result);const r=Object.keys(h);console.log(r),Te.getUnits(s).then(V=>{var v=(V==null?void 0:V.data)||[];for(let H=0;H<r.length;H++){var Z=v.filter(Q=>Q.UnitStandardID==parseInt(r[H]));Z.length>0&&d.push({...Z[0],UnitStandard:Z[0].US})}T(H=>({...H,units:d}))})}L.setFieldsValue(JSON.parse(s==null?void 0:s.Result))},de=()=>{E(!0),$.getWorkshopCourseResult({Code:C}).then(s=>{s.data&&k(s.data)}).finally(()=>{E(!1)})},Je=()=>{$.getCodeUnits({Code:C}).then(s=>{var d;s.data&&(T(s.data),U(s.data),oe((d=s.data)==null?void 0:d.units))})},_e=s=>{var me,B,fe;K(!0);const{FirstName:d,LastName:h,Gender:r,DOB:V,Email:v,Ethnicity:Z}=s;let H=0,Q=0;typeof((me=s==null?void 0:s.SchoolName)==null?void 0:me.value)=="number"?(Q=(B=s==null?void 0:s.SchoolName)==null?void 0:B.label,H=(fe=s==null?void 0:s.SchoolName)==null?void 0:fe.value):(Q=y.SchoolName,H=y.SchoolNumber),$.addWworkshopstudent({Code:C,FirstName:d,LastName:h,SchoolName:Q,SchoolNumber:H,Gender:r,DOB:V,Email:v,Ethnicity:Z}).then(M=>{if(M!=null&&M.data){a(!1),A.success({content:`Student ${d} ${h} has been successfully added to the workshop.`,duration:3e3}),W.resetFields();var be={label:Q,value:H};W.setFieldValue("SchoolName",be),de()}else M!=null&&M.message&&A.error(M.message)}).catch(M=>{var be,je;console.error("Add student error:",M),A.error({content:((je=(be=M==null?void 0:M.response)==null?void 0:be.data)==null?void 0:je.message)||"Failed to add student. Please try again.",duration:4e3})}).finally(()=>{K(!1)})},Qe=s=>{var h,r,V,v,Z,H,Q,me;K(!0);const d=`${G.FirstName} ${G.LastName}`;$.postStudentInfo({StudentID:G.StudentID,...s,CourseID:(h=s==null?void 0:s.CourseID)==null?void 0:h.value,CourseName:(r=s==null?void 0:s.CourseID)==null?void 0:r.label,FarmingUnits:(V=s==null?void 0:s.FarmingUnitID)==null?void 0:V.label,FarmingUnitID:(v=s==null?void 0:s.FarmingUnitID)==null?void 0:v.value,HospitalityCourses:(Z=s==null?void 0:s.HospitalityCourseID)==null?void 0:Z.label,HospitalityCourseID:(H=s==null?void 0:s.HospitalityCourseID)==null?void 0:H.value,WorklifeCourses:(Q=s==null?void 0:s.WorklifeCoursesID)==null?void 0:Q.label,WorklifeCoursesID:(me=s==null?void 0:s.WorklifeCoursesID)==null?void 0:me.value}).then(B=>{B!=null&&B.data?(t(!1),A.success({content:`Student ${d} has been successfully updated.`,duration:3e3}),W.resetFields(),de()):B!=null&&B.message&&A.error(B.message)}).catch(B=>{var fe,M;console.error("Update student error:",B),A.error({content:((M=(fe=B==null?void 0:B.response)==null?void 0:fe.data)==null?void 0:M.message)||"Failed to update student. Please try again.",duration:4e3})}).finally(()=>{K(!1)})},Xe=s=>{const d=x.find(r=>r.StudentID===s),h=d?`${d.FirstName} ${d.LastName}`:"Student";$.deleteWorkshopInfo({StudentID:s}).then(r=>{r!=null&&r.data?(A.success({content:`${h} has been successfully removed from the workshop.`,duration:3e3}),de()):r!=null&&r.message&&A.error(r.message)}).catch(r=>{var V,v;console.error("Delete student error:",r),A.error({content:((v=(V=r==null?void 0:r.response)==null?void 0:V.data)==null?void 0:v.message)||"Failed to delete student. Please try again.",duration:4e3})})},$e=()=>{a(!1),W.resetFields()},Ve=s=>{S(s)},Re=s=>{O(s)},ze=()=>{t(!1),z.resetFields()},Ze=()=>{i(!1),L.resetFields()},Be=()=>{I(!1)},et=s=>{I(s)},Me=s=>{console.log(n),_(s)},tt=s=>{ge(!0);const d=q.filter(r=>r.IsAditional===!0).map(r=>r.UnitStandardID).join(","),h=x.length;$.assessAllresult({Code:C,Result:s,AdditionalUnits:d}).then(r=>{r!=null&&r.data?(I(!1),A.success({content:`Successfully assessed all ${h} student${h!==1?"s":""} with status: ${s.Course}`,duration:4e3}),j.resetFields(),de()):r!=null&&r.message&&A.error(r.message)}).catch(r=>{var V,v;console.error("Assess all error:",r),A.error({content:((v=(V=r==null?void 0:r.response)==null?void 0:V.data)==null?void 0:v.message)||"Failed to assess all students. Please try again.",duration:4e3})}).finally(()=>{ge(!1)})},st=s=>{console.log("newUnitSTD");let d=[...q.filter(h=>h.IsAditional!==!0),...s];oe(d)},Ce=o.exports.useMemo(()=>x.filter(s=>s.CourseStatus&&s.CourseStatus!=="Not Yet Achieved"),[x]),De=Ce.length>0;return e(Pe,{loading:b,block:!0,children:f("div",{className:Oe["workshop-result"],style:{height:500,width:"100%",visibility:b?"hidden":"visible"},children:[f("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[f("div",{style:{padding:"4px 12px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px",color:"#666"},children:[e("span",{style:{color:"#ed45a0",fontWeight:"bold"},children:"\u25CF "}),e("span",{style:{color:"#ed45a0"},children:"Pink text"})," indicates learners added manually after workshop creation"]}),f(te,{children:[e(m,{type:"primary",size:"mini",onClick:()=>{Re(!0)},children:"Send Results"}),e(m,{type:"primary",size:"mini",onClick:()=>{Ve(!0)},children:"Workshop Status"}),e(m,{type:"primary",size:"mini",onClick:()=>{a(!0)},children:"Add"}),f(m,{type:"primary",size:"mini",disabled:!De,onClick:s=>{s.stopPropagation(),ce(!0),le(!0)},title:De?`Generate certificates for ${Ce.length} assessed student${Ce.length!==1?"s":""}`:"No assessed students available",children:["Generate all certificates ",De?`(${Ce.length})`:""]}),e(m,{type:"primary",size:"mini",onClick:s=>{s.stopPropagation(),ce(!0),et(!0)},children:"Assess all"})]})]}),e("div",{children:e(we,{rowKey:"StudentID",rowClassName:s=>s!=null&&s.isAdd?Oe["is-add"]:"",columns:pe,data:x,loading:b,scroll:{y:450},border:{wrapper:!0,cell:!0},pagination:!1})}),e(pt,{certificateVisible:Ie,certificateVisibleHandle:()=>{le(!1)},Code:C,isAll:Ne,rowData:G,studentData:x,ok:()=>{le(!1)}}),e(mt,{sendResultVisible:g,sendResultVisibleHandle:Re,rowData:y,isWorkshop:!0,ok:()=>{O(!1)}}),e(ne,{title:"Add",visible:X,footer:null,onCancel:$e,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"800px"},children:e(rt,{form:W,handleSubmit:_e,loading:J,handleCancel:$e})}),e(It,{Code:C,statusVisible:u,setStatusVisible:Ve,WorkshopStatus:N,list:F}),e(ne,{title:"Edit workshop Learner",visible:ue,footer:null,onCancel:ze,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"70%"},children:e(ft,{form:z,handleSubmit:Qe,handleCancel:ze,loading:J,headerInfo:G})}),e(ne,{title:"Assess All",visible:P,footer:null,onCancel:Be,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px"},children:f(p,{form:j,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:tt,children:[e(p.Item,{label:`${(Ye=D==null?void 0:D.course)==null?void 0:Ye.CourseName} Full Course`,field:"Course",rules:[{required:!0,message:"required"}],children:e(R,{allowClear:!0,options:Ge,placeholder:"please enter",onChange:s=>{var h;let d={};(h=w==null?void 0:w.units)==null||h.forEach(r=>{var V=""+String(r.UnitStandardID);d[V]=s}),j.setFieldsValue(d)}})}),q==null?void 0:q.map(s=>f(it,{children:[e("label",{children:s.IsAditional?"Aditional":""}),e(p.Item,{label:`${s.UnitStandard} - ${s.USName}`,field:String(s.UnitStandardID),rules:[{required:!0,message:"required"}],children:e(R,{allowClear:!0,options:Ge,placeholder:"please enter"})},s.UnitStandardID)]})),e(p.Item,{style:{textAlign:"center"},children:f(te,{children:[e(m,{loading:ye,type:"primary",onClick:()=>{Me(!0)},children:"Add additional US"}),e(m,{loading:ye,type:"primary",htmlType:"submit",children:"Submit"}),e(m,{onClick:Be,children:"Cancel"})]})})]})}),e(St,{id:(G==null?void 0:G.id)||0,assessVisible:l,setAssessVisible:Ze,studentData:G,assesCourseData:G,list:de}),e(wt,{id:he,unitVisible:Y,setUnitVisible:Me,studentData:re,refreshData:st,studentUnitStaderd:q})]})})}const Dt=R.Option;function At({loading:C,form:N,handleSubmit:F,handleCancel:y,rowData:b}){const E=ae(l=>l.token),[x,k]=o.exports.useState([]),[w,T]=o.exports.useState([]),[D,U]=o.exports.useState([]),[W,L]=o.exports.useState(),[j,z]=o.exports.useState([]),[X,a]=o.exports.useState([]),[u,S]=o.exports.useState(!1);o.exports.useEffect(()=>{var l;E&&(g(),J(),O()),((l=b==null?void 0:b.UnitStandardIDs)==null?void 0:l.length)>0&&(S(!0),N.setFieldsValue({UnitStandardIDs:b.UnitStandardIDs.split(",").map(i=>Number(i))}))},[E,b]);const g=async(l={})=>{try{const[i,P]=await Promise.all([$.getCourse({}),$.getSchool({})]);k((i==null?void 0:i.data)||[]),T(i==null?void 0:i.data.filter(I=>I.IsCustom==!0).map(I=>I.CourseID)),U((P==null?void 0:P.data)||[])}catch(i){console.error("Failed to load options:",i)}},O=async(l={})=>{try{const i=await Te.getUnits(l);a((i==null?void 0:i.data)||[])}catch(i){console.error("Failed to load unit standards:",i)}},J=async(l={})=>{try{const i=await yt.getAll(l);z((i==null?void 0:i.data)||[])}catch(i){console.error("Failed to load teachers:",i)}},K=l=>{w.includes(l.value)?S(!0):S(!1)};return e("div",{className:He["search-form-wrapper"],children:f(p,{form:N,className:He["search-form"],labelAlign:"left",wrapperCol:{span:24},onSubmit:F,children:[e(p.Item,{label:"Workshop Name",field:"CourseName",children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:x.map(l=>({label:l.CourseName,value:l.CourseID})),filterOption:(l,i)=>{var P,I,Y;return((I=(P=i.props.value)==null?void 0:P.label)==null?void 0:I.toLowerCase().indexOf(l.toLowerCase()))>=0||((Y=i.props)==null?void 0:Y.children.toLowerCase().indexOf(l.toLowerCase()))>=0},placeholder:"Select workshop",onChange:K})}),u&&e(p.Item,{label:"Unit Standards",field:"UnitStandardIDs",children:e(R,{mode:"multiple",placeholder:"Select unit standards",allowClear:!0,showSearch:!0,filterOption:(l,i)=>{var P,I,Y;return((Y=(I=(P=i.props)==null?void 0:P.children)==null?void 0:I.toLowerCase())==null?void 0:Y.indexOf(l==null?void 0:l.toLowerCase()))>=0},children:X.map(l=>e(Dt,{value:l.UnitStandardID,children:`${l.US} - ${l.USName}`},l.UnitStandardID))})}),e(p.Item,{label:"Course Date",field:"CourseDate",rules:[{required:!0,message:"required"}],children:e(dt,{format:l=>`${l.format("DD/MM/YYYY")}`,style:{width:"100%"}})}),e(p.Item,{label:"School Name",field:"SchoolName",rules:[{required:!0,message:"required"}],children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:D.map(l=>({label:l.SchoolName,value:l.SchoolNumber})),allowCreate:{formatter:l=>({value:l,label:l})},filterOption:(l,i)=>{var P,I,Y;return((I=(P=i.props.value)==null?void 0:P.label)==null?void 0:I.toLowerCase().indexOf(l.toLowerCase()))>=0||((Y=i.props)==null?void 0:Y.children.toLowerCase().indexOf(l.toLowerCase()))>=0},placeholder:"please select (If the option does not exist, you can enter it manually)",onChange:l=>{var i=D.filter(P=>P.SchoolNumber==l.value);i.length>0?L(i[0]):L(null)}})}),W&&e("p",{children:gt(W)}),e(p.Item,{label:"Number of learners attending",field:"StudentsNum",rules:[{required:!0,message:"required"}],children:e(ct,{placeholder:"Please enter",min:0,style:{width:"100%"}})}),e(p.Item,{label:"Teacher",field:"TutorId",children:e(R,{allowClear:!0,options:j.map(l=>({label:l.DeliverySpecialist,value:l.Id})),placeholder:"please enter"})}),e(p.Item,{label:"Payment Status",field:"PaymentStatus",children:e(R,{allowClear:!0,options:["Paid","Partially Paid","Unpaid"],placeholder:"Select payment status"})}),e(p.Item,{style:{textAlign:"center"},children:f(te,{children:[e(m,{loading:C,type:"primary",htmlType:"submit",children:"Submit"}),e(m,{onClick:y,children:"Cancel"})]})})]})})}const Fe=Ee.TabPane,{Text:Ue}=ut,{Option:Le}=R;function $t(){const C=ae(t=>t.token),[N,F]=o.exports.useState(!1),[y,b]=o.exports.useState([]),[E,x]=o.exports.useState({WorkshopID:0}),[k,w]=o.exports.useState(!1),[T]=ee(),[D,U]=o.exports.useState(!1),[W,L]=o.exports.useState(""),[j,z]=o.exports.useState([]),[X,a]=o.exports.useState([]),[u,S]=o.exports.useState("1"),[g,O]=o.exports.useState({}),[J,K]=o.exports.useState({current:1,pageSize:10,total:0,showTotal:!0,showJumper:!0,sizeCanChange:!0,pageSizeChangeResetCurrent:!0}),l=ae(t=>t.isAdmin),i=ae(t=>t.userInfo),P=t=>{const c={Processed:{status:"success",text:"Processed"},Unprocessed:{status:"warning",text:"Unprocessed"},Completed:{status:"success",text:"Completed"},Cancelled:{status:"error",text:"Cancelled"},"In Progress":{status:"processing",text:"In Progress"}}[t]||{status:"default",text:t};return e(xe,{status:c.status,text:c.text})},I=[{title:"Workshop Name",dataIndex:"CourseName",key:"CourseName",width:180,fixed:"left"},{title:"Code",dataIndex:"Code",key:"Code",width:230},{title:"Course Date",dataIndex:"CourseDate",key:"CourseDate",width:120,render:t=>Ke(t).format("DD/MM/YYYY")},{title:"School Name",dataIndex:"SchoolName",key:"SchoolName"},{title:"Location",dataIndex:"Location",key:"Location",ellipsis:!0},{title:"Number of learners attending",dataIndex:"StudentsNum",key:"StudentsNum",ellipsis:!0,width:100},{title:"Teacher",dataIndex:"Tutor",key:"Tutor",ellipsis:!l,hideInTable:!1},{title:"Payment Status",dataIndex:"PaymentStatus",key:"PaymentStatus",width:170,render:(t,n)=>f(R,{value:t||"Unpaid",size:"small",style:{width:"150px"},onChange:c=>G(n.WorkshopID,c),onClick:c=>c.stopPropagation(),children:[e(Le,{value:"Paid",children:e(xe,{status:"success",text:"Paid"})}),e(Le,{value:"Partially Paid",children:e(xe,{status:"warning",text:"Partially Paid"})}),e(Le,{value:"Unpaid",children:e(xe,{status:"error",text:"Unpaid"})})]})},{title:"Workshop Status",dataIndex:"WorkshopStatus",key:"WorkshopStatus",width:150,render:t=>P(t)},{title:"Operation",dataIndex:"Operation",render:(t,n)=>f(te,{children:[e(m,{type:"primary",size:"mini",onClick:()=>{L(n.Code),x(n),U(!0)},children:"details"}),e(m,{type:"primary",size:"mini",onClick:()=>{x(n),T.setFieldsValue({...n,CourseName:{label:n.CourseName,value:n.CourseID},SchoolName:{label:n.SchoolName,value:n.SchoolNumber}}),w(!0)},children:"Edit"}),e("div",{onClick:c=>{c.stopPropagation()},children:e(ve,{focusLock:!0,title:"Confirm",content:"Are you sure you want to delete?",onOk:()=>{ge(n.WorkshopID)},children:e(m,{type:"primary",status:"danger",size:"mini",children:"Delete"})})})]}),fixed:"right",width:150}],Y=[{key:"1",title:"All"},{key:"2",title:"Processed"},{key:"3",title:"Unprocessed"}],_=async(t={})=>{F(!0);try{const n=await $.getWorkshop({...g,...t,Email:l?"":i.mail}),c=(n==null?void 0:n.data)||[];b(c),K(q=>({...q,total:c.length}))}catch(n){console.error("Failed to load workshops:",n),A.error("Failed to load workshops. Please try again."),b([]),K(c=>({...c,total:0}))}finally{F(!1)}},ye=(t={})=>{$.getCourse({}).then(n=>{z((n==null?void 0:n.data)||[])}),$.getSchool({}).then(n=>{a((n==null?void 0:n.data)||[])})},ge=async t=>{try{const n=await $.deleteWorkshop({WorkshopID:t});n!=null&&n.data&&(Se.success({title:"Success",content:"Workshop has been deleted successfully",duration:3e3}),_())}catch(n){console.error("Failed to delete workshop:",n),Se.error({title:"Error",content:"Failed to delete workshop. Please try again.",duration:5e3})}},G=async(t,n)=>{try{const c=await $.WorkshopPaymentStatusChange({WorkshopID:t,PaymentStatus:n});if((c==null?void 0:c.code)===0){A.success("Payment status updated successfully");const q=Y.find(oe=>oe.key===u);_(u!=="1"?{Status:q.title}:{})}else A.error((c==null?void 0:c.message)||"Failed to update payment status")}catch(c){console.error("Failed to update payment status:",c),A.error("Failed to update payment status. Please try again.")}};o.exports.useEffect(()=>{C&&(ye(),_())},[C]);const se=t=>{x(t),T.setFieldsValue({...t,CourseName:{label:t.CourseName,value:t.CourseID},SchoolName:{label:t.SchoolName,value:t.SchoolNumber}}),w(!0)};function Ie(t){var n;_({CourseID:(n=t==null?void 0:t.CourseID)==null?void 0:n.value,Code:t.Code,Status:t==null?void 0:t.Status,SchoolNumber:t==null?void 0:t.schoolOptionVal})}const le=t=>`${t.Street} ${t.Suburb?", "+t.Suburb:""} ${t.City?", "+t.City:""} ,  ${t.DHB}`,Ne=async t=>{var n,c,q,oe;F(!0);try{const re=X.filter(pe=>{var ie;return pe.SchoolNumber==((ie=t==null?void 0:t.SchoolName)==null?void 0:ie.value)});if(!re.length){Se.warning({title:"Validation Error",content:"Selected school not found. Please select a valid school.",duration:4e3});return}const We=le(re[0]),he=await $.postWorkshop({WorkshopID:E.WorkshopID,...t,CourseID:(n=t==null?void 0:t.CourseName)==null?void 0:n.value,CourseName:(c=t==null?void 0:t.CourseName)==null?void 0:c.label,SchoolNumber:(q=t==null?void 0:t.SchoolName)==null?void 0:q.value,SchoolName:(oe=t==null?void 0:t.SchoolName)==null?void 0:oe.label,Location:We});if(he!=null&&he.data){Se.success({title:"Success",content:"Workshop has been updated successfully",duration:3e3}),w(!1),T.resetFields();const pe=Y.find(ie=>ie.key===u);_(u!=="1"?{Status:pe.title}:{})}}catch(re){console.error("Failed to update workshop:",re),Se.error({title:"Error",content:"Failed to update workshop. Please try again.",duration:5e3})}finally{F(!1)}},ce=t=>{S(t),K(c=>({...c,current:1}));const n=Y.find(c=>c.key===t);_(t!=="1"?{Status:n.title}:{})},ue=(t,n)=>{K(c=>({...c,current:t,pageSize:n}))};return f("div",{style:{padding:0,margin:0},children:[e(qe,{style:{marginBottom:"16px"},children:e(xt,{onSearch:Ie})}),e(qe,{children:f(Ee,{defaultActiveTab:"1",destroyOnHide:!0,onChange:ce,children:[f(Fe,{title:"All",children:[e(we,{columns:I,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:N,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ue,showTotal:t=>`Total ${t} workshops`},noDataElement:e(Ae,{description:"No workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>se(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Ue,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"1"),f(Fe,{title:"Processed",children:[e(we,{columns:I,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:N,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ue,showTotal:t=>`Total ${t} processed workshops`},noDataElement:e(Ae,{description:"No processed workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>se(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Ue,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"2"),f(Fe,{title:"Unprocessed",children:[e(we,{columns:I,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:N,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ue,showTotal:t=>`Total ${t} unprocessed workshops`},noDataElement:e(Ae,{description:"No unprocessed workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>se(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Ue,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"3")]})}),e(ne,{title:"Learners",visible:D,footer:e("div",{style:{textAlign:"center"},children:e(m,{type:"primary",onClick:()=>U(!1),children:"ok"})}),onCancel:()=>U(!1),autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"100%"},children:e(Nt,{Code:W,status:E.WorkshopStatus,getWorkshopList:_,workShopData:E})}),e(ne,{title:"Edit My Workshop",visible:k,footer:null,onCancel:()=>{w(!1),T.resetFields()},autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"600px"},children:e(At,{form:T,handleCancel:()=>{w(!1),T.resetFields()},handleSubmit:Ne,loading:N,rowData:E})})]})}export{$t as default};
