import{K as se,r as s,ah as st,l as T,j as e,L as p,k as m,J as R,V as at,Q as te,U as f,ai as nt,G as lt,a8 as ee,S as Pe,ag as ae,M as g,bd as rt,F as it,O as dt,P as ct,C as qe,a6 as Fe,ad as ut,aa as fe,N as Se}from"./index.bfa4e677.js";import{T as Ee}from"./index.d6d3904f.js";import{I as ht,P as Ge}from"./communication.bf3d45a4.js";import{h as Ke}from"./moment.0f22a298.js";import{b as Oe,c as pt,S as mt,U as ft,A as St}from"./updateForm.9d8bd793.js";import{c as Te,t as yt}from"./teacher.b2f809ec.js";import{R as we}from"./index.1ed8ca1f.js";import{s as ve,g as gt}from"./addressHelper.877a29ba.js";const{Row:Ct,Col:ke}=lt,{useForm:bt}=p;function xt(x){const[A]=bt(),L=se(a=>a.token),[y,k]=s.exports.useState([]),[W,w]=s.exports.useState([]),[I,N]=s.exports.useState({SchoolNumber:0}),[$,F]=s.exports.useState(!1),O=s.exports.useRef(st(a=>{x.onSearch({...a,schoolOptionVal:I==null?void 0:I.SchoolNumber}),F(!1)},500)).current;s.exports.useEffect(()=>()=>{O.cancel()},[O]),s.exports.useEffect(()=>{L&&V()},[L]);const V=()=>{T.getCourse({}).then(a=>{k((a==null?void 0:a.data)||[])}),T.getSchool({}).then(a=>{w((a==null?void 0:a.data)||[])})},P=a=>{x.onSearch({...a,schoolOptionVal:I==null?void 0:I.SchoolNumber})},q=()=>{F(!0);const a=A.getFieldsValue();O({...a,schoolOptionVal:I==null?void 0:I.SchoolNumber})},Y=()=>{O.cancel(),F(!1),A.resetFields(),x.onSearch({})},X=a=>{a.key==="Enter"&&(O.cancel(),F(!1),A.submit())};return e("div",{children:e(p,{form:A,className:Oe["search-form"],labelAlign:"left",layout:"vertical",autoComplete:"off",style:{marginBottom:"16px"},onSubmit:P,children:m(Ct,{gutter:[12,12],children:[e(ke,{xs:24,sm:12,md:8,lg:6,xl:5,children:e(p.Item,{label:"Workshop Name",field:"CourseID",style:{marginBottom:0},children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,filterOption:(a,u)=>{var S,C,E;return((C=(S=u.props.value)==null?void 0:S.label)==null?void 0:C.toLowerCase().indexOf(a.toLowerCase()))>=0||((E=u.props)==null?void 0:E.children.toLowerCase().indexOf(a.toLowerCase()))>=0},options:y.map(a=>({label:a.CourseName,value:a.CourseID})),placeholder:"Select workshop"})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:4,children:e(p.Item,{label:"Workshop Code",field:"Code",style:{marginBottom:0},children:e(at,{onKeyDown:X,onChange:q,allowClear:!0,placeholder:"Enter code"})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:5,children:e(p.Item,{label:"School Name",field:"SchoolName",style:{marginBottom:0},children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:W.map(a=>({label:a.SchoolName,value:a.SchoolNumber})),allowCreate:{formatter:a=>({value:a,label:a})},filterOption:(a,u)=>{var S,C,E;return((C=(S=u.props.value)==null?void 0:S.label)==null?void 0:C.toLowerCase().indexOf(a.toLowerCase()))>=0||((E=u.props)==null?void 0:E.children.toLowerCase().indexOf(a.toLowerCase()))>=0},placeholder:"Select school",onChange:a=>{if(!a){N(null);return}const u=W.filter(S=>S.SchoolNumber==a.value);u.length>0?N(u[0]):N(null)}})})}),e(ke,{xs:24,sm:12,md:8,lg:6,xl:4,style:{display:"flex",alignItems:"flex-end"},children:m(te,{wrap:!0,style:{marginBottom:0},children:[e(f,{type:"primary",icon:e(nt,{}),onClick:()=>{A.submit()},children:"Search"}),e(f,{icon:e(ht,{}),onClick:Y,children:"Reset"})]})})]})})})}const kt=p.Item;R.Option;function wt({id:x,unitVisible:A,setUnitVisible:L,studentData:y,assesCourseData:k,refreshData:W,studentUnitStaderd:w}){const[I,N]=s.exports.useState(!1),$=se(a=>a.token),[F]=ee(),[O,V]=s.exports.useState(!1);s.exports.useState({});const[P,q]=s.exports.useState([]);s.exports.useEffect(()=>{console.log("inti Assess"),$&&(console.log("inti Assess b"),Y(k)),k&&console.log("inti Assess c : ",x)},[$,y,k,w]);const Y=(a={})=>{Te.getUnits(a).then(u=>{if(q((u==null?void 0:u.data)||[]),console.log("Alll aditional unitstd",w),w){var S=w.filter(C=>C.IsAditional==!0).map(C=>C.UnitStandardID);F.setFieldValue("UnitStandardIDs",S)}})};return e(Pe,{loading:I,block:!0,children:e(ae,{title:"Unit Standard",visible:A,footer:null,onCancel:()=>{L(!1)},autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px",height:"50%"},children:m(p,{form:F,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:a=>{var S;V(!0);var u=[];(S=a==null?void 0:a.UnitStandardIDs)==null||S.forEach(C=>{console.log(C);var E=P.filter(J=>J.UnitStandardID==C);E.length>0&&u.push({...E[0],UnitStandard:E[0].US,IsAditional:!0})}),W(u),L(!1),V(!1)},children:[e(kt,{label:"Unit Standards",field:"UnitStandardIDs",children:e(R,{mode:"multiple",placeholder:"Select unit standards",allowClear:!0,showSearch:!0,options:P==null?void 0:P.map(a=>({label:`${a.US} - ${a.USName}`,value:a.UnitStandardID})),filterOption:(a,u)=>{var S,C,E;return((C=(S=u.props.value)==null?void 0:S.label)==null?void 0:C.toLowerCase().indexOf(a.toLowerCase()))>=0||((E=u.props)==null?void 0:E.children.toLowerCase().indexOf(a.toLowerCase()))>=0}})}),e(p.Item,{style:{textAlign:"center",marginTop:"50%"},children:m(te,{children:[e(f,{loading:O,type:"primary",htmlType:"submit",children:"Submit"}),e(f,{onClick:()=>{L(!1)},children:"Cancel"})]})})]})})})}function It({Code:x,statusVisible:A,setStatusVisible:L,WorkshopStatus:y,list:k}){const[W,w]=s.exports.useState(!1),I=se(P=>P.token),[N]=ee(),[$,F]=s.exports.useState(!1);s.exports.useEffect(()=>{console.log("inti Assess"),N.resetFields(),I&&console.log("inti Assess b"),y&&N.setFieldValue("Status",y)},[I,y]);const O=()=>{L(!1)};return e(Pe,{loading:W,block:!0,children:e(ae,{title:"Change Workshop Status",visible:A,footer:null,onCancel:O,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px"},children:m(p,{form:N,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:P=>{F(!0);var q={...P,code:x};console.log(q),T.WorkshopStatusChange(q).then(Y=>{Y!=null&&Y.data&&(L(!1),g.success("success"),k())}).finally(()=>{F(!1)})},children:[e(p.Item,{label:"Workshop Status",field:"Status",children:e(R,{allowClear:!0,options:["Unprocessed","Processed"],placeholder:"please enter"})}),e(p.Item,{style:{textAlign:"center"},children:m(te,{children:[e(f,{loading:$,type:"primary",htmlType:"submit",children:"Submit"}),e(f,{onClick:O,children:"Cancel"})]})})]})})})}p.Item;Ee.TabPane;R.Option;const He=["Achieved","Partially Completed","Merit","Excellence","Not Yet Achieved"];function Nt({Code:x,status:A,getWorkshopList:L,workShopData:y}){var Me;const[k,W]=s.exports.useState(!1),[w,I]=s.exports.useState([]),[N,$]=s.exports.useState({}),[F,O]=s.exports.useState({}),[V]=ee(),[P]=ee(),[q]=ee();ee();const[Y]=ee(),[X,a]=s.exports.useState(!1),[u,S]=s.exports.useState(!1),[C,E]=s.exports.useState(!1),[J,K]=s.exports.useState(!1),[l,d]=s.exports.useState(!1),[D,b]=s.exports.useState(!1),[U,Ie]=s.exports.useState(!1),[ge,Ce]=s.exports.useState(!1);s.exports.useState(!1);const[H,oe]=s.exports.useState({}),[Ne,ne]=s.exports.useState(!1),[De,de]=s.exports.useState(!1),[ce,t]=s.exports.useState(!1);s.exports.useState([]);const[n,r]=s.exports.useState([]),[B,_]=s.exports.useState([]),[le,We]=s.exports.useState([]),ue=0,he=[{title:"Learner Name",key:"StudentName",dataIndex:"StudentName",width:150,render:(o,c)=>`${c.FirstName||""} ${c.LastName||""}`},{title:"DOB",dataIndex:"DateOfBirth",key:"DateOfBirth",width:100,ellipsis:!0,render:o=>Ke(o).format("DD/MM/YYYY")},{title:"Gender",dataIndex:"Gender",key:"Gender",width:80},{title:"Ethnicity",dataIndex:"Ethnicity",key:"Ethnicity",ellipsis:!0,width:100},{title:"Email",dataIndex:"Email",key:"Email",ellipsis:!0,width:150},{title:"School Name",dataIndex:"SchoolName",key:"SchoolName",ellipsis:!0,width:150},{title:"Course Status",dataIndex:"CourseStatus",key:"CourseStatus",width:105,render:o=>e("span",{style:{fontSize:"12px"},children:o})},{title:"Operation",dataIndex:"operation",key:"operation",render:(o,c)=>m(te,{children:[e(f,{type:"primary",size:"mini",onClick:h=>{h.stopPropagation(),re(c),oe(c),d(!0)},children:"Assess"}),e(f,{type:"primary",size:"mini",onClick:h=>{if(h.stopPropagation(),console.log(c),!c.CourseStatus)return g.warning("Not yet assessed");if(!c.CourseStatus||c.CourseStatus==="Not Yet Achieved")return g.warning("Not yet achieved");de(!1),oe(c),ne(!0)},children:"Certificate"}),e(f,{type:"primary",size:"mini",onClick:h=>{h.stopPropagation(),oe(c),Y.setFieldsValue({...c,SchoolName:c.SchoolNumber?c.SchoolNumber:c.SchoolName}),t(!0)},children:"Edit"}),e("div",{onClick:h=>{h.stopPropagation()},children:e(Ge,{focusLock:!0,title:"Confirm",content:"Are you sure you want to delete?",onOk:()=>{Xe(c.StudentID)},children:e(f,{type:"primary",status:"danger",size:"mini",children:"Delete"})})})]}),width:220}];s.exports.useEffect(()=>{ie(),Je();var o={label:y.SchoolName,value:y.SchoolNumber};V.setFieldValue("SchoolName",o)},[x]),s.exports.useEffect(()=>{},[n]);const re=o=>{var c=[];if(o!=null&&o.Result){var h=JSON.parse(o.Result);const i=Object.keys(h);console.log(i),Te.getUnits(o).then(z=>{var G=(z==null?void 0:z.data)||[];for(let v=0;v<i.length;v++){var Z=G.filter(Q=>Q.UnitStandardID==parseInt(i[v]));Z.length>0&&c.push({...Z[0],UnitStandard:Z[0].US})}$(v=>({...v,units:c}))})}P.setFieldsValue(JSON.parse(o==null?void 0:o.Result))},ie=()=>{W(!0),T.getWorkshopCourseResult({Code:x}).then(o=>{o.data&&I(o.data)}).finally(()=>{W(!1)})},Je=()=>{T.getCodeUnits({Code:x}).then(o=>{var c;o.data&&($(o.data),O(o.data),_((c=o.data)==null?void 0:c.units))})},_e=o=>{var pe,M,me;K(!0);const{FirstName:c,LastName:h,Gender:i,DOB:z,Email:G,Ethnicity:Z}=o;let v=0,Q=0;typeof((pe=o==null?void 0:o.SchoolName)==null?void 0:pe.value)=="number"?(Q=(M=o==null?void 0:o.SchoolName)==null?void 0:M.label,v=(me=o==null?void 0:o.SchoolName)==null?void 0:me.value):(Q=y.SchoolName,v=y.SchoolNumber),T.addWworkshopstudent({Code:x,FirstName:c,LastName:h,SchoolName:Q,SchoolNumber:v,Gender:i,DOB:z,Email:G,Ethnicity:Z}).then(j=>{if(j!=null&&j.data){a(!1),g.success({content:`Student ${c} ${h} has been successfully added to the workshop.`,duration:3e3}),V.resetFields();var xe={label:Q,value:v};V.setFieldValue("SchoolName",xe),ie()}else j!=null&&j.message&&g.error(j.message)}).catch(j=>{var xe,je;console.error("Add student error:",j),g.error({content:((je=(xe=j==null?void 0:j.response)==null?void 0:xe.data)==null?void 0:je.message)||"Failed to add student. Please try again.",duration:4e3})}).finally(()=>{K(!1)})},Qe=o=>{var h,i,z,G,Z,v,Q,pe;K(!0);const c=`${H.FirstName} ${H.LastName}`;T.postStudentInfo({StudentID:H.StudentID,...o,CourseID:(h=o==null?void 0:o.CourseID)==null?void 0:h.value,CourseName:(i=o==null?void 0:o.CourseID)==null?void 0:i.label,FarmingUnits:(z=o==null?void 0:o.FarmingUnitID)==null?void 0:z.label,FarmingUnitID:(G=o==null?void 0:o.FarmingUnitID)==null?void 0:G.value,HospitalityCourses:(Z=o==null?void 0:o.HospitalityCourseID)==null?void 0:Z.label,HospitalityCourseID:(v=o==null?void 0:o.HospitalityCourseID)==null?void 0:v.value,WorklifeCourses:(Q=o==null?void 0:o.WorklifeCoursesID)==null?void 0:Q.label,WorklifeCoursesID:(pe=o==null?void 0:o.WorklifeCoursesID)==null?void 0:pe.value}).then(M=>{M!=null&&M.data?(t(!1),g.success({content:`Student ${c} has been successfully updated.`,duration:3e3}),V.resetFields(),ie()):M!=null&&M.message&&g.error(M.message)}).catch(M=>{var me,j;console.error("Update student error:",M),g.error({content:((j=(me=M==null?void 0:M.response)==null?void 0:me.data)==null?void 0:j.message)||"Failed to update student. Please try again.",duration:4e3})}).finally(()=>{K(!1)})},Xe=o=>{const c=w.find(i=>i.StudentID===o),h=c?`${c.FirstName} ${c.LastName}`:"Student";T.deleteWorkshopInfo({StudentID:o}).then(i=>{i!=null&&i.data?(g.success({content:`${h} has been successfully removed from the workshop.`,duration:3e3}),ie()):i!=null&&i.message&&g.error(i.message)}).catch(i=>{var z,G;console.error("Delete student error:",i),g.error({content:((G=(z=i==null?void 0:i.response)==null?void 0:z.data)==null?void 0:G.message)||"Failed to delete student. Please try again.",duration:4e3})})},$e=()=>{a(!1),V.resetFields()},Ve=o=>{S(o)},Re=o=>{E(o)},ze=()=>{t(!1),Y.resetFields()},Ze=()=>{d(!1),P.resetFields()},Ye=()=>{b(!1)},et=o=>{b(o)},Be=o=>{console.log(n),Ie(o)},tt=o=>{Ce(!0);const c=B.filter(i=>i.IsAditional===!0).map(i=>i.UnitStandardID).join(","),h=w.length;T.assessAllresult({Code:x,Result:o,AdditionalUnits:c}).then(i=>{i!=null&&i.data?(b(!1),g.success({content:`Successfully assessed all ${h} student${h!==1?"s":""} with status: ${o.Course}`,duration:4e3}),q.resetFields(),ie()):i!=null&&i.message&&g.error(i.message)}).catch(i=>{var z,G;console.error("Assess all error:",i),g.error({content:((G=(z=i==null?void 0:i.response)==null?void 0:z.data)==null?void 0:G.message)||"Failed to assess all students. Please try again.",duration:4e3})}).finally(()=>{Ce(!1)})},ot=o=>{console.log("newUnitSTD");let c=[...B.filter(h=>h.IsAditional!==!0),...o];_(c)},be=s.exports.useMemo(()=>w.filter(o=>o.CourseStatus&&o.CourseStatus!=="Not Yet Achieved"),[w]),Ae=be.length>0;return e(Pe,{loading:k,block:!0,children:m("div",{className:Oe["workshop-result"],style:{height:500,width:"100%",visibility:k?"hidden":"visible"},children:[m("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[m("div",{style:{padding:"4px 12px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px",color:"#666"},children:[e("span",{style:{color:"#ed45a0",fontWeight:"bold"},children:"\u25CF "}),e("span",{style:{color:"#ed45a0"},children:"Pink text"})," indicates learners added manually after workshop creation"]}),m(te,{children:[e(f,{type:"primary",size:"mini",onClick:()=>{Re(!0)},children:"Send Results"}),e(f,{type:"primary",size:"mini",onClick:()=>{Ve(!0)},children:"Workshop Status"}),e(f,{type:"primary",size:"mini",onClick:()=>{a(!0)},children:"Add"}),m(f,{type:"primary",size:"mini",disabled:!Ae,onClick:o=>{o.stopPropagation(),de(!0),ne(!0)},title:Ae?`Generate certificates for ${be.length} assessed student${be.length!==1?"s":""}`:"No assessed students available",children:["Generate all certificates ",Ae?`(${be.length})`:""]}),e(f,{type:"primary",size:"mini",onClick:o=>{o.stopPropagation(),de(!0),et(!0)},children:"Assess all"})]})]}),e("div",{children:e(we,{rowKey:"StudentID",rowClassName:o=>o!=null&&o.isAdd?Oe["is-add"]:"",columns:he,data:w,loading:k,scroll:{y:450},border:{wrapper:!0,cell:!0},pagination:!1})}),e(pt,{certificateVisible:Ne,certificateVisibleHandle:()=>{ne(!1)},Code:x,isAll:De,rowData:H,studentData:w,ok:()=>{ne(!1)}}),e(mt,{sendResultVisible:C,sendResultVisibleHandle:Re,rowData:y,isWorkshop:!0,ok:()=>{E(!1)}}),e(ae,{title:"Add",visible:X,footer:null,onCancel:$e,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"800px"},children:e(rt,{form:V,handleSubmit:_e,loading:J,handleCancel:$e})}),e(It,{Code:x,statusVisible:u,setStatusVisible:Ve,WorkshopStatus:A,list:L}),e(ae,{title:"Edit workshop Learner",visible:ce,footer:null,onCancel:ze,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"70%"},children:e(ft,{form:Y,handleSubmit:Qe,handleCancel:ze,loading:J,headerInfo:H})}),e(ae,{title:"Assess All",visible:D,footer:null,onCancel:Ye,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px"},children:m(p,{form:q,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:tt,children:[e(p.Item,{label:`${(Me=F==null?void 0:F.course)==null?void 0:Me.CourseName} Full Course`,field:"Course",rules:[{required:!0,message:"required"}],children:e(R,{allowClear:!0,options:He,placeholder:"please enter",onChange:o=>{var h;let c={};(h=N==null?void 0:N.units)==null||h.forEach(i=>{var z=""+String(i.UnitStandardID);c[z]=o}),q.setFieldsValue(c)}})}),B==null?void 0:B.map(o=>m(it,{children:[e("label",{children:o.IsAditional?"Aditional":""}),e(p.Item,{label:`${o.UnitStandard} - ${o.USName}`,field:String(o.UnitStandardID),rules:[{required:!0,message:"required"}],children:e(R,{allowClear:!0,options:He,placeholder:"please enter"})},o.UnitStandardID)]})),e(p.Item,{style:{textAlign:"center"},children:m(te,{children:[e(f,{loading:ge,type:"primary",onClick:()=>{Be(!0)},children:"Add additional US"}),e(f,{loading:ge,type:"primary",htmlType:"submit",children:"Submit"}),e(f,{onClick:Ye,children:"Cancel"})]})})]})}),e(St,{id:(H==null?void 0:H.id)||0,assessVisible:l,setAssessVisible:Ze,studentData:H,assesCourseData:H,list:ie}),e(wt,{id:ue,unitVisible:U,setUnitVisible:Be,studentData:le,refreshData:ot,studentUnitStaderd:B})]})})}const Dt=R.Option;function At({loading:x,form:A,handleSubmit:L,handleCancel:y,rowData:k}){const W=se(l=>l.token),[w,I]=s.exports.useState([]),[N,$]=s.exports.useState([]),[F,O]=s.exports.useState([]),[V,P]=s.exports.useState(),[q,Y]=s.exports.useState([]),[X,a]=s.exports.useState([]),[u,S]=s.exports.useState(!1);s.exports.useEffect(()=>{var l;W&&(C(),J(),E()),((l=k==null?void 0:k.UnitStandardIDs)==null?void 0:l.length)>0&&(S(!0),A.setFieldsValue({UnitStandardIDs:k.UnitStandardIDs.split(",").map(d=>Number(d))}))},[W,k]);const C=async(l={})=>{try{const[d,D]=await Promise.all([T.getCourse({}),T.getSchool({})]);I((d==null?void 0:d.data)||[]),$(d==null?void 0:d.data.filter(b=>b.IsCustom==!0).map(b=>b.CourseID)),O((D==null?void 0:D.data)||[])}catch(d){console.error("Failed to load options:",d)}},E=async(l={})=>{try{const d=await Te.getUnits(l);a((d==null?void 0:d.data)||[])}catch(d){console.error("Failed to load unit standards:",d)}},J=async(l={})=>{try{const d=await yt.getAll(l);Y((d==null?void 0:d.data)||[])}catch(d){console.error("Failed to load teachers:",d)}},K=l=>{N.includes(l.value)?S(!0):S(!1)};return e("div",{className:ve["search-form-wrapper"],children:m(p,{form:A,className:ve["search-form"],labelAlign:"left",wrapperCol:{span:24},onSubmit:L,children:[e(p.Item,{label:"Workshop Name",field:"CourseName",children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:w.map(l=>({label:l.CourseName,value:l.CourseID})),filterOption:(l,d)=>{var D,b,U;return((b=(D=d.props.value)==null?void 0:D.label)==null?void 0:b.toLowerCase().indexOf(l.toLowerCase()))>=0||((U=d.props)==null?void 0:U.children.toLowerCase().indexOf(l.toLowerCase()))>=0},placeholder:"Select workshop",onChange:K})}),u&&e(p.Item,{label:"Unit Standards",field:"UnitStandardIDs",children:e(R,{mode:"multiple",placeholder:"Select unit standards",allowClear:!0,showSearch:!0,filterOption:(l,d)=>{var D,b,U;return((U=(b=(D=d.props)==null?void 0:D.children)==null?void 0:b.toLowerCase())==null?void 0:U.indexOf(l==null?void 0:l.toLowerCase()))>=0},children:X.map(l=>e(Dt,{value:l.UnitStandardID,children:`${l.US} - ${l.USName}`},l.UnitStandardID))})}),e(p.Item,{label:"Course Date",field:"CourseDate",rules:[{required:!0,message:"required"}],children:e(dt,{format:l=>`${l.format("DD/MM/YYYY")}`,style:{width:"100%"}})}),e(p.Item,{label:"School Name",field:"SchoolName",rules:[{required:!0,message:"required"}],children:e(R,{labelInValue:!0,showSearch:!0,allowClear:!0,options:F.map(l=>({label:l.SchoolName,value:l.SchoolNumber})),allowCreate:{formatter:l=>({value:l,label:l})},filterOption:(l,d)=>{var D,b,U;return((b=(D=d.props.value)==null?void 0:D.label)==null?void 0:b.toLowerCase().indexOf(l.toLowerCase()))>=0||((U=d.props)==null?void 0:U.children.toLowerCase().indexOf(l.toLowerCase()))>=0},placeholder:"please select (If the option does not exist, you can enter it manually)",onChange:l=>{var d=F.filter(D=>D.SchoolNumber==l.value);d.length>0?P(d[0]):P(null)}})}),V&&e("p",{children:gt(V)}),e(p.Item,{label:"Number of learners attending",field:"StudentsNum",rules:[{required:!0,message:"required"}],children:e(ct,{placeholder:"Please enter",min:0,style:{width:"100%"}})}),e(p.Item,{label:"Teacher",field:"TutorId",children:e(R,{allowClear:!0,options:q.map(l=>({label:l.DeliverySpecialist,value:l.Id})),placeholder:"please enter"})}),e(p.Item,{label:"Payment Status",field:"PaymentStatus",children:e(R,{allowClear:!0,options:["Paid","Partially Paid","Unpaid"],placeholder:"Select payment status"})}),e(p.Item,{style:{textAlign:"center"},children:m(te,{children:[e(f,{loading:x,type:"primary",htmlType:"submit",children:"Submit"}),e(f,{onClick:y,children:"Cancel"})]})})]})})}const Ue=Ee.TabPane,{Text:Le}=ut,{Option:ye}=R;function $t(){const x=se(t=>t.token),[A,L]=s.exports.useState(!1),[y,k]=s.exports.useState([]),[W,w]=s.exports.useState({WorkshopID:0}),[I,N]=s.exports.useState(!1),[$]=ee(),[F,O]=s.exports.useState(!1),[V,P]=s.exports.useState(""),[q,Y]=s.exports.useState([]),[X,a]=s.exports.useState([]),[u,S]=s.exports.useState("1"),[C,E]=s.exports.useState({}),[J,K]=s.exports.useState({current:1,pageSize:10,total:0,showTotal:!0,showJumper:!0,sizeCanChange:!0,pageSizeChangeResetCurrent:!0}),l=se(t=>t.isAdmin),d=se(t=>t.userInfo),D=[{title:"Workshop Name",dataIndex:"CourseName",key:"CourseName",width:180,fixed:"left"},{title:"Code",dataIndex:"Code",key:"Code",width:230},{title:"Course Date",dataIndex:"CourseDate",key:"CourseDate",width:120,render:t=>Ke(t).format("DD/MM/YYYY")},{title:"School Name",dataIndex:"SchoolName",key:"SchoolName"},{title:"Location",dataIndex:"Location",key:"Location",ellipsis:!0},{title:"Number of learners attending",dataIndex:"StudentsNum",key:"StudentsNum",ellipsis:!0,width:100},{title:"Teacher",dataIndex:"Tutor",key:"Tutor",ellipsis:!l,hideInTable:!1},{title:"Payment Status",dataIndex:"PaymentStatus",key:"PaymentStatus",width:140,render:(t,n)=>m(R,{value:t||"Unpaid",size:"small",style:{width:"120px"},onChange:r=>Ce(n.WorkshopID,r),onClick:r=>r.stopPropagation(),children:[e(ye,{value:"Paid",children:e(fe,{status:"success",text:"Paid"})}),e(ye,{value:"Partially Paid",children:e(fe,{status:"warning",text:"Partially Paid"})}),e(ye,{value:"Unpaid",children:e(fe,{status:"error",text:"Unpaid"})})]})},{title:"Workshop Status",dataIndex:"WorkshopStatus",key:"WorkshopStatus",width:150,render:(t,n)=>m(R,{value:t||"Unprocessed",size:"small",style:{width:"130px"},onChange:r=>H(n.Code,r),onClick:r=>r.stopPropagation(),children:[e(ye,{value:"Unprocessed",children:e(fe,{status:"warning",text:"Unprocessed"})}),e(ye,{value:"Processed",children:e(fe,{status:"success",text:"Processed"})})]})},{title:"Operation",dataIndex:"Operation",render:(t,n)=>m(te,{children:[e(f,{type:"primary",size:"mini",onClick:()=>{P(n.Code),w(n),O(!0)},children:"details"}),e(f,{type:"primary",size:"mini",onClick:()=>{w(n),$.setFieldsValue({...n,CourseName:{label:n.CourseName,value:n.CourseID},SchoolName:{label:n.SchoolName,value:n.SchoolNumber}}),N(!0)},children:"Edit"}),e("div",{onClick:r=>{r.stopPropagation()},children:e(Ge,{focusLock:!0,title:"Confirm",content:"Are you sure you want to delete?",onOk:()=>{ge(n.WorkshopID)},children:e(f,{type:"primary",status:"danger",size:"mini",children:"Delete"})})})]}),fixed:"right",width:150}],b=[{key:"1",title:"All"},{key:"2",title:"Processed"},{key:"3",title:"Unprocessed"}],U=async(t={})=>{L(!0);try{const n=await T.getWorkshop({...C,...t,Email:l?"":d.mail}),r=(n==null?void 0:n.data)||[];k(r),K(B=>({...B,total:r.length}))}catch(n){console.error("Failed to load workshops:",n),g.error("Failed to load workshops. Please try again."),k([]),K(r=>({...r,total:0}))}finally{L(!1)}},Ie=(t={})=>{T.getCourse({}).then(n=>{Y((n==null?void 0:n.data)||[])}),T.getSchool({}).then(n=>{a((n==null?void 0:n.data)||[])})},ge=async t=>{try{const n=await T.deleteWorkshop({WorkshopID:t});n!=null&&n.data&&(Se.success({title:"Success",content:"Workshop has been deleted successfully",duration:3e3}),U())}catch(n){console.error("Failed to delete workshop:",n),Se.error({title:"Error",content:"Failed to delete workshop. Please try again.",duration:5e3})}},Ce=async(t,n)=>{try{const r=await T.WorkshopPaymentStatusChange({WorkshopID:t,PaymentStatus:n});if((r==null?void 0:r.code)===0){g.success("Payment status updated successfully");const B=b.find(_=>_.key===u);U(u!=="1"?{Status:B.title}:{})}else g.error((r==null?void 0:r.message)||"Failed to update payment status")}catch(r){console.error("Failed to update payment status:",r),g.error("Failed to update payment status. Please try again.")}},H=async(t,n)=>{try{const r=await T.WorkshopStatusChange({code:t,Status:n});if((r==null?void 0:r.code)===0){g.success("Workshop status updated successfully");const B=b.find(_=>_.key===u);U(u!=="1"?{Status:B.title}:{})}else g.error((r==null?void 0:r.message)||"Failed to update workshop status")}catch(r){console.error("Failed to update workshop status:",r),g.error("Failed to update workshop status. Please try again.")}};s.exports.useEffect(()=>{x&&(Ie(),U())},[x]);const oe=t=>{w(t),$.setFieldsValue({...t,CourseName:{label:t.CourseName,value:t.CourseID},SchoolName:{label:t.SchoolName,value:t.SchoolNumber}}),N(!0)};function Ne(t){var n;U({CourseID:(n=t==null?void 0:t.CourseID)==null?void 0:n.value,Code:t.Code,Status:t==null?void 0:t.Status,SchoolNumber:t==null?void 0:t.schoolOptionVal})}const ne=t=>`${t.Street} ${t.Suburb?", "+t.Suburb:""} ${t.City?", "+t.City:""} ,  ${t.DHB}`,De=async t=>{var n,r,B,_;L(!0);try{const le=X.filter(he=>{var re;return he.SchoolNumber==((re=t==null?void 0:t.SchoolName)==null?void 0:re.value)});if(!le.length){Se.warning({title:"Validation Error",content:"Selected school not found. Please select a valid school.",duration:4e3});return}const We=ne(le[0]),ue=await T.postWorkshop({WorkshopID:W.WorkshopID,...t,CourseID:(n=t==null?void 0:t.CourseName)==null?void 0:n.value,CourseName:(r=t==null?void 0:t.CourseName)==null?void 0:r.label,SchoolNumber:(B=t==null?void 0:t.SchoolName)==null?void 0:B.value,SchoolName:(_=t==null?void 0:t.SchoolName)==null?void 0:_.label,Location:We});if(ue!=null&&ue.data){Se.success({title:"Success",content:"Workshop has been updated successfully",duration:3e3}),N(!1),$.resetFields();const he=b.find(re=>re.key===u);U(u!=="1"?{Status:he.title}:{})}}catch(le){console.error("Failed to update workshop:",le),Se.error({title:"Error",content:"Failed to update workshop. Please try again.",duration:5e3})}finally{L(!1)}},de=t=>{S(t),K(r=>({...r,current:1}));const n=b.find(r=>r.key===t);U(t!=="1"?{Status:n.title}:{})},ce=(t,n)=>{K(r=>({...r,current:t,pageSize:n}))};return m("div",{style:{padding:0,margin:0},children:[e(qe,{style:{marginBottom:"16px"},children:e(xt,{onSearch:Ne})}),e(qe,{children:m(Ee,{defaultActiveTab:"1",destroyOnHide:!0,onChange:de,children:[m(Ue,{title:"All",children:[e(we,{columns:D,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:A,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ce,showTotal:t=>`Total ${t} workshops`},noDataElement:e(Fe,{description:"No workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>oe(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Le,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"1"),m(Ue,{title:"Processed",children:[e(we,{columns:D,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:A,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ce,showTotal:t=>`Total ${t} processed workshops`},noDataElement:e(Fe,{description:"No processed workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>oe(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Le,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"2"),m(Ue,{title:"Unprocessed",children:[e(we,{columns:D,data:y.map(t=>({...t,key:t.WorkshopID||t.Code})),loading:A,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:{...J,onChange:ce,showTotal:t=>`Total ${t} unprocessed workshops`},noDataElement:e(Fe,{description:"No unprocessed workshops found. Try adjusting your search filters."}),onRow:(t,n)=>({onDoubleClick:()=>oe(t),style:{cursor:"pointer"}})}),y.length>0&&e("div",{style:{marginTop:"12px",textAlign:"center"},children:e(Le,{type:"secondary",style:{fontSize:"12px"},children:"\u{1F4A1} Tip: Double-click any row to edit workshop details"})})]},"3")]})}),e(ae,{title:"Learners",visible:F,footer:e("div",{style:{textAlign:"center"},children:e(f,{type:"primary",onClick:()=>O(!1),children:"ok"})}),onCancel:()=>O(!1),autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"100%"},children:e(Nt,{Code:V,status:W.WorkshopStatus,getWorkshopList:U,workShopData:W})}),e(ae,{title:"Edit My Workshop",visible:I,footer:null,onCancel:()=>{N(!1),$.resetFields()},autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"600px"},children:e(At,{form:$,handleCancel:()=>{N(!1),$.resetFields()},handleSubmit:De,loading:A,rowData:W})})]})}export{$t as default};
