import{g as U,r as a,h as I,a as e,F as n,j as S,S as P,m as M,l as v,B as h,s as pe,G as ee,v as fe,q as te,a0 as me,M as w,x as G,y as Ce,z as Se,A as Q}from"./index.dbab94e8.js";import{I as ye,M as E,D as be}from"./index.b2408667.js";import{T as xe,a as ke}from"./index.027a4f8b.js";import{C as ge}from"./index.40af5fda.js";import{h as se}from"./moment.0f22a298.js";import{R as Ie,P as Ne}from"./index.1602af59.js";var q={"workshop-result":"_workshop-result_9i6tk_1","is-add":"_is-add_9i6tk_1"};const{Row:we,Col:Pe}=ee,{useForm:Re}=n;function Le(d){const[p]=Re(),k=U(i=>i.token),[g,N]=a.exports.useState([]);a.exports.useEffect(()=>{k&&l()},[k]);const l=()=>{I.getCourse({}).then(i=>{N((i==null?void 0:i.data)||[])})},R=i=>{d.onSearch(i)},m=()=>{p.resetFields(),d.onSearch({})};return e("div",{children:e(n,{form:p,className:q["search-form"],labelAlign:"left",layout:"inline",style:{display:"inline-block",marginBottom:"10px"},onSubmit:R,children:S(we,{children:[e(n.Item,{label:"Workshop Name",field:"CourseID",children:e(P,{style:{width:"339px"},labelInValue:!0,showSearch:!0,allowClear:!0,filterOption:(i,y)=>{var b,x,o;return((x=(b=y.props.value)==null?void 0:b.label)==null?void 0:x.toLowerCase().indexOf(i.toLowerCase()))>=0||((o=y.props)==null?void 0:o.children.toLowerCase().indexOf(i.toLowerCase()))>=0},options:g.map(i=>({label:i.CourseName,value:i.CourseID})),placeholder:"please enter"})}),e(n.Item,{label:"Workshop Code",field:"Code",children:e(M,{allowClear:!0,placeholder:"Please enter the workshop Code"})}),S(v,{children:[e(h,{type:"primary",icon:e(pe,{}),onClick:()=>{p.submit()},children:"Search"}),e(h,{icon:e(ye,{}),onClick:m,children:"Reset"})]})]})})})}const{Row:Fe,Col:Me}=ee,Ae=({rowData:d,ok:p,Code:k,isAll:g})=>{const[N]=n.useForm(),[l,R]=a.exports.useState(!1),[m,i]=a.exports.useState(null),[y,b]=a.exports.useState(!1),x=U(f=>f.userInfo),o=f=>{i(f)},c=f=>{R(f)},V=f=>{b(!0),f.type===1?I.sendEmail({WorkshopResultID:g?void 0:d.WorkshopResultID,Code:k,email:l?x.mail:f.email}).then(L=>{L.data&&(w.success("Successfully sent!"),p())}).finally(()=>{b(!1)}):f.type===2&&I.sendEmailMicro({WorkshopResultID:g?void 0:d.WorkshopResultID,Code:k,email:l?x.mail:f.email,NSN:f.NSN}).then(L=>{L.data&&(w.success("Successfully sent!"),p())}).finally(()=>{b(!1)})},F=()=>{N.resetFields(),R(!1),i(null)};return e(fe,{children:S(te,{tip:"Just a moment...",loading:y,children:[g?e("p",{children:"Generate certificates for all learners in the workshop"}):S("p",{children:["Learner Name:",`${d.FirstName||""} ${d.LastName||""}`]}),e(n,{form:N,className:q["search-form"],layout:"vertical",labelAlign:"left",wrapperCol:{span:24},style:{display:"inline-block",marginBottom:"10px"},onSubmit:V,children:S(Fe,{children:[e(n.Item,{label:"Choose Certificate",field:"type",rules:[{required:!0,message:"required"}],children:e(P,{showSearch:!0,options:[{label:"Certificate of Achievement",value:1},{label:"Micro-Credential",value:2}],placeholder:"Please enter",onChange:o})}),e(n.Item,{children:e(me,{checked:l,onChange:c,children:"Send to default email"})}),!l&&e(n.Item,{label:"Send to Email",field:"email",rules:[{required:!0,message:"required"},{match:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"Please enter a valid email!"}],children:e(M,{placeholder:"Please enter email address"})}),m===2&&e(n.Item,{label:"NSN",field:"NSN",rules:[{required:!0,message:"required"}],children:e(M,{placeholder:"Please enter NSN"})}),e(n.Item,{style:{textAlign:"center"},children:S(v,{children:[e(h,{type:"primary",loading:y,onClick:()=>{N.submit()},children:"Submit"}),e(h,{onClick:F,children:"Reset"})]})})]})})]})})};xe.TabPane;const X=["Achieved","Merit","Excellence","Not Yet Achieved"];function Ee({Code:d}){var K,H;const[p,k]=a.exports.useState(!1),[g,N]=a.exports.useState([]),[l,R]=a.exports.useState({}),[m]=G(),[i]=G(),[y]=G(),[b,x]=a.exports.useState(!1),[o,c]=a.exports.useState(!1),[V,F]=a.exports.useState(!1),[f,L]=a.exports.useState(!1),[C,Y]=a.exports.useState({}),[le,W]=a.exports.useState(!1),[ae,T]=a.exports.useState(!1),[ie,B]=a.exports.useState(!1);a.exports.useState([]);const oe=[{title:"Learner Name",key:"StudentName",dataIndex:"StudentName",width:150,render:(s,t)=>`${t.FirstName||""} ${t.LastName||""}`},{title:"DOB",dataIndex:"DateOfBirth",key:"DateOfBirth",width:100,ellipsis:!0,render:s=>se(s).format("YYYY-MM-DD")},{title:"Gender",dataIndex:"Gender",key:"Gender",width:80},{title:"Ethnicity",dataIndex:"Ethnicity",key:"Ethnicity",ellipsis:!0,width:100},{title:"Email",dataIndex:"Email",key:"Email",ellipsis:!0,width:150},{title:"School Name",dataIndex:"SchoolName",key:"SchoolName",ellipsis:!0,width:150},{title:"Course Status",dataIndex:"CourseStatus",key:"CourseStatus",width:105,render:s=>e("span",{style:{fontSize:"12px"},children:s})},{title:"Operation",dataIndex:"operation",key:"operation",render:(s,t)=>S(v,{children:[e(h,{type:"primary",size:"mini",onClick:r=>{r.stopPropagation(),Y(t),F(!0)},children:"Assess"}),e(h,{type:"primary",size:"mini",onClick:r=>{if(r.stopPropagation(),t.Status==="Did Not Complete"||t.Status==="Withdraws")return w.warning(t.Status);if(!t.Result)return w.warning("Not yet assessed");const u=JSON.parse(t.Result);if(!(u!=null&&u.Course)||(u==null?void 0:u.Course)==="Not Yet Achieved")return w.warning("Not yet assessed");T(!1),Y(t),W(!0)},children:"Certificate"}),e(h,{type:"primary",size:"mini",onClick:r=>{r.stopPropagation(),Y(t),y.setFieldsValue({...t,SchoolName:t.SchoolNumber?t.SchoolNumber:t.SchoolName}),B(!0)},children:"Edit"}),e("div",{onClick:r=>{r.stopPropagation()},children:e(Ne,{focusLock:!0,title:"Confirm",content:"Are you sure you want to delete?",onOk:()=>{ue(t.WorkshopResultID)},children:e(h,{type:"primary",status:"danger",size:"mini",children:"Delete"})})})]}),width:220}];a.exports.useEffect(()=>{A(),re()},[d]);const A=()=>{k(!0),I.getWorkshopResult({Code:d}).then(s=>{s.data&&N(s.data)}).finally(()=>{k(!1)})},re=()=>{I.getCodeUnits({Code:d}).then(s=>{s.data&&R(s.data)})},ne=s=>{c(!0);const{FirstName:t,LastName:r,SchoolName:u,Gender:D,DOB:O,Email:z,Ethnicity:$}=s;I.addWorkshopInfoExtra({Code:d,FirstName:t,LastName:r,SchoolName:u==null?void 0:u.label,SchoolNumber:u==null?void 0:u.value,Gender:D,DOB:O,Email:z,Ethnicity:$}).then(_=>{_!=null&&_.data&&(x(!1),w.success("success"),m.resetFields(),A())}).finally(()=>{c(!1)})},de=s=>{L(!0),I.submitResult({WorkshopResultID:C==null?void 0:C.WorkshopResultID,Result:s}).then(t=>{t!=null&&t.data&&(F(!1),w.success("success"),i.resetFields(),A())}).finally(()=>{L(!1)})},ce=s=>{c(!0);let{SchoolName:t}=s;typeof t=="number"?t={label:C.SchoolName,value:s==null?void 0:s.SchoolName}:typeof(t==null?void 0:t.value)=="string"&&(t={label:t.value,value:0}),I.postWorkshopInfo({WorkshopResultID:C.WorkshopResultID,...s,SchoolName:t==null?void 0:t.label,SchoolNumber:t==null?void 0:t.value}).then(r=>{r!=null&&r.data&&(B(!1),w.success("success"),m.resetFields(),A())}).finally(()=>{c(!1)})},ue=s=>{I.deleteWorkshopInfo({WorkshopResultID:s}).then(t=>{t!=null&&t.data&&(w.success("success"),A())})},j=()=>{x(!1),m.resetFields()},J=()=>{B(!1),y.resetFields()},Z=()=>{F(!1),i.resetFields()},he=s=>{var D,O,z;if(!s.Result)return"Not yet assessed";if(!(l!=null&&l.units)||!((D=l==null?void 0:l.course)!=null&&D.CourseName))return"Loading";const t=JSON.parse(s.Result),r=(O=l==null?void 0:l.units)==null?void 0:O.map($=>({label:`${$.USName}:`,value:t[String($.UnitStandardID)]})),u=[{label:`${(z=l==null?void 0:l.course)==null?void 0:z.CourseName} Full Course:`,value:t.Course},...r];return e(be,{layout:"inline-horizontal",column:1,border:!0,data:u})};return e(te,{loading:p,block:!0,children:S("div",{className:q["workshop-result"],style:{height:500,width:"100%",visibility:p?"hidden":"visible"},children:[e("div",{style:{textAlign:"right",marginBottom:"10px"},children:S(v,{children:[e(h,{type:"primary",size:"mini",onClick:()=>{x(!0)},children:"Add"}),e(h,{type:"primary",size:"mini",onClick:s=>{s.stopPropagation(),T(!0),W(!0)},children:"Generate all certificates"})]})}),e("div",{children:e(Ie,{rowKey:"WorkshopResultID",rowClassName:s=>s!=null&&s.isAdd?q["is-add"]:"",expandedRowRender:he,expandProps:{icon:({expanded:s,record:t,...r})=>s?e("button",{...r,children:e(Ce,{})}):e("button",{...r,children:e(Se,{})}),expandRowByClick:!0},columns:oe,data:g,loading:p,scroll:{y:450},border:{wrapper:!0,cell:!0},pagination:!1})}),e(E,{title:"Generate Certificate",visible:le,footer:null,onCancel:()=>{W(!1)},autoFocus:!1,focusLock:!0,unmountOnExit:!0,children:e(Ae,{Code:d,isAll:ae,rowData:C,ok:()=>{W(!1)}})}),e(E,{title:"Add",visible:b,footer:null,onCancel:j,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"800px"},children:e(Q,{form:m,handleSubmit:ne,loading:o,handleCancel:j})}),e(E,{title:"Edit Workshop Learner",visible:ie,footer:null,onCancel:J,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"600px"},children:e(Q,{isEdit:!0,form:y,handleSubmit:ce,loading:o,handleCancel:J})}),e(E,{title:"Assess",visible:V,footer:null,onCancel:Z,autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"500px"},children:S(n,{form:i,layout:"vertical",labelAlign:"left",wrapperCol:{span:24},onSubmit:de,children:[e(n.Item,{label:"Learner Name",children:e(M,{defaultValue:`${(C==null?void 0:C.FirstName)||""} ${(C==null?void 0:C.LastName)||""}`,style:{width:"100%"},disabled:!0,placeholder:"please enter"})}),e(n.Item,{label:`${(K=l==null?void 0:l.course)==null?void 0:K.CourseName} Full Course`,field:"Course",rules:[{required:!0,message:"required"}],children:e(P,{allowClear:!0,options:X,placeholder:"please enter"})}),(H=l==null?void 0:l.units)==null?void 0:H.map(s=>e(n.Item,{label:s.USName,field:String(s.UnitStandardID),rules:[{required:!0,message:"required"}],children:e(P,{allowClear:!0,options:X,placeholder:"please enter"})},s.UnitStandardID)),e(n.Item,{style:{textAlign:"center"},children:S(v,{children:[e(h,{loading:f,type:"primary",htmlType:"submit",children:"Submit"}),e(h,{onClick:Z,children:"Cancel"})]})})]})})]})})}function qe(){const d=[{title:"Workshop Name",dataIndex:"CourseName",width:180,fixed:"left"},{title:"Code",dataIndex:"Code",width:230},{title:"Course Date",dataIndex:"CourseDate",width:120,render:o=>se(o).format("YYYY-MM-DD")},{title:"School Name",dataIndex:"SchoolName"},{title:"Location",dataIndex:"Location",ellipsis:!0},{title:"Number of learners attending",dataIndex:"StudentsNum",ellipsis:!0,width:100},{title:"Operation",dataIndex:"Operation",render:(o,c)=>e(h,{type:"primary",size:"mini",onClick:()=>{y(c.Code),m(!0)},children:"details"}),fixed:"right",width:100}],p=U(o=>o.token),[k,g]=a.exports.useState(!1),[N,l]=a.exports.useState([]),[R,m]=a.exports.useState(!1),[i,y]=a.exports.useState(""),b=(o={})=>{g(!0),I.getWorkshop({...o}).then(c=>{l((c==null?void 0:c.data)||[])}).finally(()=>{g(!1)})};a.exports.useEffect(()=>{p&&b()},[p]);function x(o){var c;b({CourseID:(c=o==null?void 0:o.CourseID)==null?void 0:c.value,Code:o.Code})}return S(ge,{children:[e(Le,{onSearch:x}),e(ke,{columns:d,data:N,loading:k,scroll:{x:1300},border:{wrapper:!0,cell:!0},pagination:!1}),e(E,{title:"Learners",visible:R,footer:e("div",{style:{textAlign:"center"},children:e(h,{type:"primary",onClick:()=>m(!1),children:"ok"})}),onCancel:()=>m(!1),autoFocus:!1,focusLock:!0,unmountOnExit:!0,style:{width:"100%"},children:e(Ee,{Code:i})})]})}export{qe as default};
