import{K as se,r as a,l as w,ab as ne,k as o,C as Y,j as t,ad as s,Q as b,U as C,b3 as ce,J as p,aH as de,b6 as he,O as pe,M as u}from"./index.bfa4e677.js";import{T as G}from"./index.d6d3904f.js";import ue from"./report1.ae104c6a.js";import ge from"./report2.45719cdf.js";import me from"./report3.5ecc4b81.js";import ye from"./report4.10436d76.js";import Se from"./report5.f6bb8912.js";import Te from"./report6.e6f21ca1.js";import{h as v}from"./moment.0f22a298.js";import{s as fe,e as Re}from"./excelExport.fffc6efd.js";import"./exceljs.min.044c08df.js";import"./FileSaver.min.75cbdb4e.js";const{RangePicker:Ce}=pe,{Option:n}=p,N=[{key:"StudentID",label:"Student ID",dataType:"number"},{key:"FirstName",label:"First Name",dataType:"string"},{key:"LastName",label:"Last Name",dataType:"string"},{key:"Email",label:"Email",dataType:"string"},{key:"PhoneNumber",label:"Phone Number",dataType:"string"},{key:"DateOfBirth",label:"Date of Birth",dataType:"date"},{key:"Gender",label:"Gender",dataType:"string"},{key:"Ethnicity",label:"Ethnicity",dataType:"string"},{key:"School",label:"School",dataType:"string"},{key:"SchoolNumber",label:"School Number",dataType:"string"},{key:"Tutor",label:"Tutor",dataType:"string"},{key:"Status",label:"Status",dataType:"string"},{key:"AssignedTo",label:"Assigned To",dataType:"string"},{key:"Fees",label:"Fees",dataType:"string"},{key:"Region",label:"Region",dataType:"string"},{key:"City",label:"City",dataType:"string"},{key:"StreetAddress",label:"Street Address",dataType:"string"},{key:"Zipcode",label:"Zipcode",dataType:"string"},{key:"CreateDate",label:"Registration Date",dataType:"date"},{key:"WorkbookOption",label:"Workbook Option",dataType:"string"},{key:"TeacherName",label:"Teacher Name",dataType:"string"},{key:"TeacherEmail",label:"Teacher Email",dataType:"string"},{key:"InvoiceEmail",label:"Invoice Email",dataType:"string"}];function Ee(){const O=se(e=>e.token),[j,A]=a.exports.useState(!1),[g,L]=a.exports.useState([]),[D,H]=a.exports.useState([]),[i,E]=a.exports.useState(["FirstName","LastName","Email","School","Status","CreateDate"]),[c,U]=a.exports.useState([String(v().year()),String(v().year())]),[F,$]=a.exports.useState(void 0),[B,W]=a.exports.useState(void 0),[S,I]=a.exports.useState([]),[T,M]=a.exports.useState([]),[f,z]=a.exports.useState([]),[R,P]=a.exports.useState([]),[J,Z]=a.exports.useState([]),[V,q]=a.exports.useState([]),[K,Q]=a.exports.useState([]),[_]=a.exports.useState(["NZ European","Maori","Cook Island Maori","Niuean","Samoan","Tongan","Fijian","Tokelauan","Chinese","Indian","Japanese","Korean","Vietnamese","Filipino","Malaysian","Indonesian","Thai","Middle Eastern/Latin American/African","Other"]);a.exports.useEffect(()=>{O&&(X(),ee(),te())},[O]);const X=async()=>{try{const e=await w.getSchool();if(e.code===0){const l=(e.data||[]).sort((r,d)=>{var m,y;const x=((m=r.SchoolName)==null?void 0:m.toLowerCase())||"",k=((y=d.SchoolName)==null?void 0:y.toLowerCase())||"";return x.localeCompare(k)});Z(l)}}catch(e){console.error("Error loading schools:",e)}},ee=async()=>{try{const e=await w.getAllTutorList();if(e.code===0){const l=(e.data||[]).sort((r,d)=>{var m,y;const x=((m=r.DeliverySpecialist)==null?void 0:m.toLowerCase())||"",k=((y=d.DeliverySpecialist)==null?void 0:y.toLowerCase())||"";return x.localeCompare(k)});q(l)}}catch(e){console.error("Error loading tutors:",e)}},te=async()=>{try{const e=await ne.getReport({pageSize:1e4,isReport:1});if(e.code===0&&e.data&&e.data[1]){const l=[...new Set(e.data[1].map(r=>r.Region).filter(r=>r&&r.trim()!==""))].sort();Q(l)}}catch(e){console.error("Error loading regions:",e)}};a.exports.useEffect(()=>{const e=i.map(l=>{const r=N.find(d=>d.key===l);return r?{title:r.label,dataIndex:r.key,key:r.key,width:150,ellipsis:!0,render:d=>d?r.dataType==="date"?v(d).format("DD/MM/YYYY"):d:"-"}:null}).filter(Boolean);H(e),i.includes("School")||I([]),i.includes("Tutor")||M([]),i.includes("Region")||z([]),i.includes("Ethnicity")||P([])},[i]);const re=()=>{if(i.length===0){u.warning("Please select at least one field to display");return}const e={fields:i.join(","),startYear:(c==null?void 0:c.length)>0?c[0]:void 0,endYear:(c==null?void 0:c.length)>0?c[1]:void 0,status:F,assignedTo:B};S.length>0&&(e.schools=S.join(",")),T.length>0&&(e.tutors=T.join(",")),f.length>0&&(e.regions=f.join(",")),R.length>0&&(e.ethnicities=R.join(",")),console.log("Starting Report 7 API call with params:",e),A(!0),w.getReport7(e).then(l=>{console.log("Report 7 API response:",l);const r=(l==null?void 0:l.data)||[];L(r),u.success(`Loaded ${r.length} records`),console.log("Data set to:",r)}).catch(l=>{console.error("Error loading report 7:",l),console.error("Error details:",l.response||l.message),u.error(`Failed to load custom report: ${l.message||"Unknown error"}`),L([])}).finally(()=>{A(!1)})},le=async()=>{if(g.length===0){u.warning("No data to export. Please run the report first.");return}try{await Re(D,g,"CUSTOM REPORT"),u.success("Excel file exported successfully!")}catch(e){console.error("Error exporting report:",e),u.error("Failed to export Excel file. Please try again.")}},ae=e=>{E(l=>l.includes(e)?l.filter(r=>r!==e):[...l,e])},oe=()=>{E(N.map(e=>e.key))},ie=()=>{E([])};return o(Y,{className:fe["reports-result"],children:[o("div",{style:{marginBottom:20,padding:"16px",background:"#f7f8fa",borderRadius:"4px"},children:[t(s.Title,{heading:6,style:{marginBottom:12},children:"Select Fields to Include in Report"}),o(b,{style:{marginBottom:12},children:[t(C,{size:"small",onClick:oe,children:"Select All"}),t(C,{size:"small",onClick:ie,children:"Clear All"}),o(s.Text,{type:"secondary",style:{marginLeft:8},children:["(",i.length," fields selected)"]})]}),t("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"8px",marginBottom:16},children:N.map(e=>t(ce,{checked:i.includes(e.key),onChange:()=>ae(e.key),children:e.label},e.key))}),t(s.Title,{heading:6,style:{marginTop:20,marginBottom:12},children:"Filter Options"}),o(b,{wrap:!0,children:[o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Date Range:"}),t(Ce,{value:c,mode:"year",style:{width:200},onChange:e=>{U(e)},size:"small"})]}),o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Status:"}),o(p,{placeholder:"All Statuses",style:{width:160},size:"small",allowClear:!0,value:F,onChange:e=>$(e),children:[t(n,{value:"On Going",children:"On Going"}),t(n,{value:"Completed",children:"Completed"}),t(n,{value:"Withdrawn",children:"Withdrawn"}),t(n,{value:"Did Not Complete",children:"Did Not Complete"}),t(n,{value:"Other",children:"Other"})]})]}),o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Assigned To:"}),o(p,{placeholder:"All",style:{width:160},size:"small",allowClear:!0,value:B,onChange:e=>W(e),children:[t(n,{value:"School",children:"School"}),t(n,{value:"GET Group",children:"GET Group"})]})]}),i.includes("School")&&o("div",{children:[t(s.Text,{style:{marginRight:8},children:"School:"}),t(p,{mode:"multiple",placeholder:"Select schools",style:{width:300},size:"small",allowClear:!0,showSearch:!0,maxTagCount:2,value:S,onChange:e=>I(e),filterOption:(e,l)=>{var r;return(r=l.props.children)==null?void 0:r.toLowerCase().includes(e.toLowerCase())},children:J.filter(e=>!S.includes(e.SchoolName)).map(e=>t(n,{value:e.SchoolName,children:e.SchoolName},e.SchoolNumber))})]}),i.includes("Tutor")&&o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Tutor:"}),t(p,{mode:"multiple",placeholder:"Select tutors",style:{width:300},size:"small",allowClear:!0,showSearch:!0,maxTagCount:2,value:T,onChange:e=>M(e),filterOption:(e,l)=>{var r;return(r=l.props.children)==null?void 0:r.toLowerCase().includes(e.toLowerCase())},children:V.filter(e=>!T.includes(e.DeliverySpecialist)).map(e=>t(n,{value:e.DeliverySpecialist,children:e.DeliverySpecialist},e.Id))})]}),i.includes("Region")&&o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Region:"}),t(p,{mode:"multiple",placeholder:"Select regions",style:{width:300},size:"small",allowClear:!0,showSearch:!0,maxTagCount:2,value:f,onChange:e=>z(e),filterOption:(e,l)=>{var r;return(r=l.props.children)==null?void 0:r.toLowerCase().includes(e.toLowerCase())},children:K.filter(e=>!f.includes(e)).map(e=>t(n,{value:e,children:e},e))})]}),i.includes("Ethnicity")&&o("div",{children:[t(s.Text,{style:{marginRight:8},children:"Ethnicity:"}),t(p,{mode:"multiple",placeholder:"Select ethnicities",style:{width:300},size:"small",allowClear:!0,showSearch:!0,maxTagCount:2,value:R,onChange:e=>P(e),filterOption:(e,l)=>{var r;return(r=l.props.children)==null?void 0:r.toLowerCase().includes(e.toLowerCase())},children:_.filter(e=>!R.includes(e)).map(e=>t(n,{value:e,children:e},e))})]})]})]}),t(de,{style:{marginBottom:16},children:o(b,{children:[t(C,{onClick:()=>re(),type:"primary",size:"mini",disabled:i.length===0,children:"Generate Report"}),t(C,{size:"mini",onClick:le,type:"primary",disabled:g.length===0,children:"Export Excel"}),o(s.Text,{type:"secondary",children:[g.length," record(s) found"]})]})}),t(he,{columns:D,data:g,loading:j,border:{wrapper:!0,cell:!0},scroll:{x:i.length*150,y:600},pagination:{pageSize:50,showTotal:!0,showJumper:!0,sizeCanChange:!0}})]})}const h=G.TabPane;function Ie(){return t(Y,{style:{height:"100%",minHeight:"80vh",overflow:"auto"},children:o(G,{defaultActiveTab:"1",destroyOnHide:!0,overflow:"wrap",children:[t(h,{title:"LEARNER ENROLMENTS + MONTH + YEAR",children:t(ue,{})},"1"),t(h,{title:"WORKSHOPS BY REGION + YEAR",children:t(ge,{})},"2"),t(h,{title:"SCHOOL + LEARNER NUMBERS + YEAR",children:t(me,{})},"3"),t(h,{title:"SCHOOL + LEARNERS  + YEAR",children:t(ye,{})},"4"),t(h,{title:"TUTOR + LEARNER NUMBERS + YEAR",children:t(Se,{})},"5"),t(h,{title:"ETHNICITY + LEARNER NUMBERS + YEAR",children:t(Te,{})},"6"),t(h,{title:"CUSTOM REPORT",children:t(Ee,{})},"7")]})})}export{Ie as default};
