import{K as k,r as t,l as x,M as r,k as y,C as R,aH as P,j as a,J as v,U as S,b6 as z,O as j}from"./index.bfa4e677.js";import{h as B}from"./moment.0f22a298.js";import{s as C,e as F}from"./excelExport.fffc6efd.js";import"./exceljs.min.044c08df.js";import"./FileSaver.min.75cbdb4e.js";const{YearPicker:M}=j;function Y(){const l=k(e=>e.token),[E,n]=t.exports.useState(!1),[i,c]=t.exports.useState([]),[o,L]=t.exports.useState(String(B().year())),[s,w]=t.exports.useState(""),p=()=>{if(!o)return r.warning("Please select a year");!s||(n(!0),x.getReport4({year:o,schoolName:s}).then(e=>{c((e==null?void 0:e.data)||[])}).catch(e=>{console.error("Error loading report 4:",e),r.error("Failed to load school learners report. Please try again."),c([])}).finally(()=>{n(!1)}))};t.exports.useEffect(()=>{N()},[]);const[b,m]=t.exports.useState([]),N=()=>{x.getSchool({}).then(e=>{m((e==null?void 0:e.data)||[])}).catch(e=>{console.error("Error loading schools:",e),r.error("Failed to load school list."),m([])})},O=async()=>{try{await F(h,i,"SCHOOL + LEARNERS  + YEAR"),r.success("Excel file exported successfully!")}catch(e){console.error("Error exporting report:",e),r.error("Failed to export Excel file. Please try again.")}};t.exports.useEffect(()=>{l&&p()},[l,o,s]);const h=[{title:`${s} - ${o}`,dataIndex:"LearnerName"}];return y(R,{className:C["reports-result"],children:[y(P,{children:[a(v,{style:{width:200,marginBottom:10,marginRight:10},labelInValue:!0,showSearch:!0,allowClear:!0,onChange:e=>w(e.label),options:b.map(e=>({label:e.SchoolName,value:e.SchoolNumber})),allowCreate:{formatter:e=>({value:e,label:e})},filterOption:(e,d)=>{var u,f,g;return((f=(u=d.props.value)==null?void 0:u.label)==null?void 0:f.toLowerCase().indexOf(e.toLowerCase()))>=0||((g=d.props)==null?void 0:g.children.toLowerCase().indexOf(e.toLowerCase()))>=0},placeholder:"SchoolName:",size:"mini"}),a(M,{value:o,style:{width:200,marginBottom:10},onChange:e=>{L(e)},size:"mini"}),a(S,{onClick:()=>p(),type:"primary",size:"mini",style:{marginLeft:20},children:"Refresh"}),a(S,{size:"mini",onClick:O,type:"primary",style:{marginLeft:20},children:"Export Excel"})]}),a(z,{columns:h,data:i,loading:E,border:{wrapper:!0,cell:!0},pagination:!1,rowClassName:e=>(e==null?void 0:e.Month)==="Total"?C["is-summary"]:""})]})}export{Y as default};
